
;; -*- mode: clojure -*-
;; vim: syntax=clojure 

;; --- DO NOT EDIT - AUTOMATICALLY GENERATED BY dev/jeroenvandijk/chess/validator/cvx.clj --- 
(defn contains? [m k] (contains-key? m k))

(defmacro comment [& _body])

(defmacro ->> [x & forms] (loop [x x forms forms] (if forms (let [form (first forms) threaded (if (list? form) (concat form [x]) (list form x))] (recur threaded (next forms))) x)))

(defmacro -> [x & forms] (loop [x x forms forms] (if forms (let [form (first forms) threaded (if (list? form) (concat (list (first form) x) (next form)) (list form x))] (recur threaded (next forms))) x)))

(defn keep [f x] (filter identity (map f x)))

(defn take-while [f coll] (reduce (fn [acc x] (if (f x) (conj acc x) (reduced acc))) [] coll))

(defn take [n coll] (first (reduce (fn [[acc n0] x] (if (zero? n0) (reduced [acc n0]) [(conj acc x) (dec n0)])) [[] n] coll)))

(defn drop [n coll] (first (reduce (fn [[acc n0] x] (if (zero? n0) [(conj acc x) n0] [acc (dec n0)])) [[] n] coll)))

(defn juxt ([f] (fn ([] [(f)]) ([x] [(f x)]) ([x y] [(f x y)]))) ([f g] (fn ([] [(f) (g)]) ([x] [(f x) (g x)]) ([x y] [(f x y) (g x y)]))))

(defn neg? [x] (< x 0))

(defn pos? [x] (> x 0))

(defn repeat [n x] (loop [acc () idx n] (if (<= idx 0) acc (recur (conj acc x) (dec idx)))))

(defn merge-with [f & maps] (when-not (empty? (filter identity maps)) (let [merge-entry (fn [m [k v]] (if (contains-key? m k) (assoc m k (f (get m k) v)) (assoc m k v))) merge2 (fn [m1 m2] (reduce merge-entry (or m1 {}) m2))] (reduce merge2 maps))))

(defn range ([end] (range 0 end)) ([start end] (range start end 1)) ([start end step] (if (neg? step) (loop [acc [] i start] (if (<= i end) acc (recur (conj acc i) (+ i step)))) (loop [acc [] i start] (if (>= i end) acc (recur (conj acc i) (+ i step)))))))

(defn not-empty [x] (when-not (empty? x) x))

(defn not= [a b] (not (= a b)))

(defn partial ([f] f) ([f arg1] (fn ([] (f arg1)) ([x] (f arg1 x)) ([x y] (f arg1 x y)) ([x y z] (f arg1 x y z)) ([x y z & args] (apply f arg1 x y z args)))) ([f arg1 arg2] (fn ([] (f arg1 arg2)) ([x] (f arg1 arg2 x)) ([x y] (f arg1 arg2 x y)) ([x y z] (f arg1 arg2 x y z)) ([x y z & args] (apply f arg1 arg2 x y z args)))) ([f arg1 arg2 arg3] (fn ([] (f arg1 arg2 arg3)) ([x] (f arg1 arg2 arg3 x)) ([x y] (f arg1 arg2 arg3 x y)) ([x y z] (f arg1 arg2 arg3 x y z)) ([x y z & args] (apply f arg1 arg2 arg3 x y z args)))) ([f arg1 arg2 arg3 & more] (fn [& args] (apply f arg1 arg2 arg3 (concat more args)))))

(defn char->numeric-value [ch] (let [i (- (int ch) 48)] (if (<= 0 i 9) i -1)))

(defn coord->file+rank [coord] (let [[file-ch rank-ch] (vec coord)] [(switch file-ch \a 0 \b 1 \c 2 \d 3 \e 4 \f 5 \g 6 \h 7) (dec (char->numeric-value rank-ch))]))

(defn file+rank->coord [[file rank]] (str (switch file 0 \a 1 \b 2 \c 3 \d 4 \e 5 \f 6 \g 7 \h) (inc rank)))

(defn file+rank->index [[file rank]] (+ file (* rank 8)))

(defn index->file+rank [idx] [(rem idx 8) (quot idx 8)])

(defn coord->index [coord] (file+rank->index (coord->file+rank coord)))

(defn index->coord [idx] (file+rank->coord (index->file+rank idx)))

(defn uci->coords [s] [(coord->index (slice s 0 2)) (coord->index (slice s 2 4))])

(defn uci->from+to [uci] (let [uci0 (uci->coords uci)] (if (= (count uci) 5) (conj uci0 ({\q :Q, \n :N, \r :R, \b :B} (last uci))) (conj uci0 nil))))

(defn coords->uci [[from to promotion-piece]] (str (index->coord from) (index->coord to) ({:Q \q, :N \n, :R \r, :B \b} promotion-piece)))

(def char->piece {\B :wB, \b :bB, \K :wK, \k :bK, \N :wN, \n :bN, \P :wP, \p :bP, \Q :wQ, \q :bQ, \R :wR, \r :bR})

(def empty-board (vec (repeat 64 nil)))

(defn board-str->board-vec [rank-str] (loop [chars (vec rank-str) col 0 row 7 acc empty-board] (if (empty? chars) acc (let [[ch & tail] chars] (if (= ch \/) (recur tail 0 (dec row) acc) (if (< col 8) (if-let [piece (get char->piece ch)] (recur tail (inc col) row (assoc acc (+ (* row 8) col) piece)) (let [i (char->numeric-value ch)] (if (<= 1 i 8) (recur tail (+ col i) row acc) (fail :ASSERT (str "Unexpected char " ch))))) (fail :ASSERT (str "Out of bounds: " col))))))))

(defn calculate-ep-from [side ep-coord] (let [[to-file to-rank] (coord->file+rank ep-coord) ep-index (file+rank->index [to-file to-rank]) from-rank (switch side :b (inc to-rank) :w (dec to-rank)) left-from-file (dec to-file) right-from-file (inc to-file)] (disj #{(when (<= 0 left-from-file) [(file+rank->index [left-from-file from-rank]) ep-index]) (when (< right-from-file 8) [(file+rank->index [right-from-file from-rank]) ep-index])} nil)))

(defn ->index-move [coords] [(coord->index (slice coords 0 2)) (coord->index (slice coords 2 4))])

(def white-kingside-castling (->index-move "e1g1"))

(def white-queenside-castling (->index-move "e1c1"))

(def black-kingside-castling (->index-move "e8g8"))

(def black-queenside-castling (->index-move "e8c8"))

(def opponent {:b :w, :w :b})

(def piece->color {:bP :b, :bN :b, :wK :w, :bQ :b, :wN :w, :bK :b, :wQ :w, :wB :w, :wR :w, :wP :w, :bB :b, :bR :b})

(defn within-bounds? [[x y]] (and (<= -7 x 7) (<= -7 y 7)))

(defn ray ([direction] (recur [0 0] direction)) ([pos direction] (let [[xd yd] direction] (loop [[x y] pos acc []] (let [pos [(+ x xd) (+ y yd)]] (if (within-bounds? pos) (recur pos (conj acc pos)) acc))))))

(defn rays [directions] (mapcat ray directions))

(def knight-deltas [[2 -1] [2 1] [1 -2] [1 2] [-1 -2] [-1 2] [-2 -1] [-2 1]])

(def king-deltas [[1 -1] [1 0] [1 1] [0 -1] [0 1] [-1 -1] [-1 0] [-1 1]])

(def bishop-directions [[-1 -1] [-1 1] [1 -1] [1 1]])

(def rook-directions [[-1 0] [0 -1] [1 0] [0 1]])

(def bishop-deltas (quote ([-1 -1] [-2 -2] [-3 -3] [-4 -4] [-5 -5] [-6 -6] [-7 -7] [-1 1] [-2 2] [-3 3] [-4 4] [-5 5] [-6 6] [-7 7] [1 -1] [2 -2] [3 -3] [4 -4] [5 -5] [6 -6] [7 -7] [1 1] [2 2] [3 3] [4 4] [5 5] [6 6] [7 7])))

(def rook-deltas (quote ([-1 0] [-2 0] [-3 0] [-4 0] [-5 0] [-6 0] [-7 0] [0 -1] [0 -2] [0 -3] [0 -4] [0 -5] [0 -6] [0 -7] [1 0] [2 0] [3 0] [4 0] [5 0] [6 0] [7 0] [0 1] [0 2] [0 3] [0 4] [0 5] [0 6] [0 7])))

(def queen-deltas (quote ([-1 -1] [-2 -2] [-3 -3] [-4 -4] [-5 -5] [-6 -6] [-7 -7] [-1 1] [-2 2] [-3 3] [-4 4] [-5 5] [-6 6] [-7 7] [1 -1] [2 -2] [3 -3] [4 -4] [5 -5] [6 -6] [7 -7] [1 1] [2 2] [3 3] [4 4] [5 5] [6 6] [7 7] [-1 0] [-2 0] [-3 0] [-4 0] [-5 0] [-6 0] [-7 0] [0 -1] [0 -2] [0 -3] [0 -4] [0 -5] [0 -6] [0 -7] [1 0] [2 0] [3 0] [4 0] [5 0] [6 0] [7 0] [0 1] [0 2] [0 3] [0 4] [0 5] [0 6] [0 7])))

(def all-positions (quote [0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63]))

(defn within-board? [x y] (and (<= 0 x 7) (<= 0 y 7)))

(defn map-moves [pos deltas] (let [[x y] (index->file+rank pos)] (into #{} (keep (fn [[xd yd]] (let [x0 (+ x xd) y0 (+ y yd)] (when (within-board? x0 y0) (file+rank->index [x0 y0])))) deltas))))

(defn map-positions ([deltas] (map-positions deltas all-positions)) ([deltas positions] (into {} (map (fn [pos] [pos (map-moves pos deltas)]) positions))))

(def king-positions (quote {0 #{1 9 8}, 62 #{55 54 61 53 63}, 7 #{15 6 14}, 59 #{58 60 50 51 52}, 20 #{27 21 13 29 28 12 19 11}, 58 #{59 50 51 57 49}, 60 #{59 61 51 53 52}, 27 #{20 36 28 34 35 19 26 18}, 1 #{0 2 9 10 8}, 24 #{32 33 25 17 16}, 55 #{62 46 54 47 63}, 39 #{46 31 47 38 30}, 46 #{55 39 54 47 45 53 38 37}, 4 #{13 3 12 11 5}, 54 #{62 55 46 61 47 45 53 63}, 15 #{7 22 6 23 14}, 48 #{40 56 41 57 49}, 50 #{59 58 41 43 51 57 42 49}, 21 #{20 13 22 29 28 12 14 30}, 31 #{39 22 23 38 30}, 32 #{24 40 33 41 25}, 40 #{48 32 33 41 49}, 56 #{48 57 49}, 33 #{24 32 40 41 25 34 26 42}, 13 #{20 4 21 22 6 12 5 14}, 22 #{15 21 31 13 29 23 14 30}, 36 #{27 43 29 44 28 35 45 37}, 41 #{48 50 32 40 33 34 42 49}, 43 #{50 36 44 51 34 35 52 42}, 61 #{62 60 54 53 52}, 29 #{20 21 22 36 28 38 30 37}, 44 #{36 43 51 35 45 53 52 37}, 6 #{7 15 13 5 14}, 28 #{20 27 21 36 29 35 19 37}, 51 #{59 58 60 50 43 44 52 42}, 25 #{24 32 33 34 17 26 16 18}, 34 #{27 33 41 43 25 35 26 42}, 17 #{24 25 9 26 16 10 18 8}, 3 #{4 12 2 11 10}, 12 #{20 4 21 13 3 19 11 5}, 2 #{1 3 11 9 10}, 23 #{15 31 22 14 30}, 47 #{55 39 46 54 38}, 35 #{27 36 43 44 28 34 26 42}, 19 #{20 27 28 12 11 26 10 18}, 57 #{58 48 50 56 49}, 11 #{20 4 3 12 2 19 10 18}, 9 #{0 1 17 2 16 10 18 8}, 5 #{4 13 6 12 14}, 14 #{7 15 21 13 22 6 23 5}, 45 #{46 54 36 44 53 38 52 37}, 53 #{62 60 46 54 61 44 45 52}, 26 #{27 33 25 34 17 35 19 18}, 16 #{24 25 17 9 8}, 38 #{39 46 31 29 47 45 30 37}, 30 #{39 21 31 22 29 23 38 37}, 10 #{1 17 3 2 19 11 9 18}, 18 #{27 25 17 19 11 9 26 10}, 52 #{59 60 43 61 44 51 45 53}, 42 #{50 33 41 43 51 34 35 49}, 37 #{46 36 29 44 28 45 38 30}, 63 #{62 55 54}, 8 #{0 1 17 9 16}, 49 #{58 48 50 40 56 41 57 42}}))

(def knight-positions (quote {0 #{17 10}, 62 #{47 45 52}, 7 #{13 22}, 59 #{44 53 42 49}, 20 #{3 35 5 14 26 30 10 37}, 58 #{48 41 43 52}, 60 #{54 50 43 45}, 27 #{21 33 44 17 12 10 42 37}, 1 #{11 16 18}, 24 #{41 34 9 18}, 55 #{61 45 38}, 39 #{54 22 29 45}, 46 #{31 36 61 29 52 63}, 4 #{21 19 14 10}, 54 #{60 39 44 37}, 15 #{21 5 30}, 48 #{58 33 42}, 50 #{60 40 56 33 44 35}, 21 #{27 4 15 31 36 6 11 38}, 31 #{46 21 14 37}, 32 #{17 26 42 49}, 40 #{50 25 34 57}, 56 #{50 41}, 33 #{27 48 50 43 16 18}, 13 #{7 28 3 23 19 30}, 22 #{7 39 28 12 5 37}, 36 #{46 21 51 19 53 26 30 42}, 41 #{58 24 56 51 35 26}, 43 #{58 60 33 28 53 26 37 49}, 61 #{55 46 44 51}, 29 #{39 46 44 12 23 35 19 14}, 44 #{59 27 54 50 61 29 34 38}, 6 #{21 12 23}, 28 #{13 22 43 34 11 45 38 18}, 51 #{36 41 61 34 57 45}, 25 #{40 35 19 10 42 8}, 34 #{24 40 44 28 51 17 19 49}, 17 #{0 27 32 34 2 11}, 3 #{20 13 9 18}, 12 #{27 22 29 6 2 18}, 2 #{17 12 19 8}, 23 #{13 29 6 38}, 47 #{62 53 30 37}, 35 #{20 50 41 29 25 45 18 52}, 19 #{4 13 36 29 25 34 2 9}, 57 #{40 51 42}, 11 #{1 21 28 17 5 26}, 9 #{24 3 19 26}, 5 #{20 15 22 11}, 14 #{20 4 31 29}, 45 #{62 60 55 39 28 51 35 30}, 53 #{59 36 43 47 38 63}, 26 #{20 32 36 41 43 11 9 16}, 16 #{1 33 26 10}, 38 #{55 21 44 28 23 53}, 30 #{20 15 13 36 47 45}, 10 #{0 20 27 4 25 16}, 18 #{1 24 33 28 3 12 35 8}, 52 #{62 58 46 35 42 37}, 42 #{59 27 48 32 36 25 57 52}, 37 #{20 27 54 31 22 43 47 52}, 63 #{46 53}, 8 #{25 2 18}, 49 #{59 32 43 34}}))

(def rook-positions (quote {0 #{7 1 24 4 48 32 40 56 6 3 2 5 16 8}, 62 #{59 58 60 46 54 56 22 61 6 57 14 38 30 63}, 7 #{0 1 55 39 4 15 31 6 3 2 23 47 5 63}, 59 #{62 58 60 27 56 43 61 51 3 35 19 57 11 63}, 20 #{60 4 21 22 36 44 28 17 12 23 19 16 18 52}, 58 #{62 59 60 50 56 61 34 2 57 26 10 18 42 63}, 60 #{62 59 20 58 4 56 36 61 44 28 12 57 52 63}, 27 #{59 24 31 43 29 28 51 25 3 35 19 11 26 30}, 1 #{0 7 4 33 41 6 25 17 3 2 57 9 5 49}, 24 #{0 27 48 31 32 40 56 29 28 25 26 16 30 8}, 55 #{7 39 54 15 48 50 31 51 23 47 53 52 63 49}, 39 #{7 55 15 31 32 33 36 34 23 47 35 38 37 63}, 46 #{62 54 40 22 41 43 44 6 47 14 45 38 30 42}, 4 #{0 7 20 60 1 36 44 6 28 3 12 2 5 52}, 54 #{62 55 46 48 50 22 6 51 14 53 38 30 52 49}, 15 #{7 55 39 31 13 12 23 47 11 9 14 10 63 8}, 48 #{0 24 55 54 50 32 40 56 51 53 16 52 8 49}, 50 #{58 55 54 48 51 34 2 53 26 10 18 52 42 49}, 21 #{20 13 22 61 29 17 23 19 5 45 53 16 18 37}, 31 #{7 27 24 55 39 15 29 28 25 23 47 26 30 63}, 32 #{0 24 39 48 40 56 33 36 34 35 16 38 37 8}, 40 #{0 24 46 48 32 56 41 43 44 47 45 16 42 8}, 56 #{0 62 59 58 60 24 48 32 40 61 57 16 63 8}, 33 #{1 39 32 36 41 25 34 17 35 57 9 38 37 49}, 13 #{15 21 61 29 12 11 9 5 14 45 53 10 37 8}, 22 #{62 20 46 54 21 6 17 23 19 14 16 38 30 18}, 36 #{20 60 39 4 32 33 44 28 34 12 35 38 52 37}, 41 #{1 46 40 33 43 44 25 17 47 57 9 45 42 49}, 43 #{59 27 46 40 41 44 51 3 47 35 19 11 45 42}, 61 #{62 59 58 60 21 56 13 29 57 5 45 53 37 63}, 29 #{27 24 21 31 13 61 28 25 5 45 53 26 30 37}, 44 #{20 60 46 4 40 36 41 43 28 12 47 45 52 42}, 6 #{0 62 7 1 46 4 54 22 3 2 5 14 38 30}, 28 #{20 60 27 24 4 31 36 29 44 25 12 26 30 52}, 51 #{59 27 55 54 48 50 43 3 35 19 11 53 52 49}, 25 #{27 1 24 31 33 41 29 28 17 57 9 26 30 49}, 34 #{58 39 50 32 33 36 2 35 26 38 10 18 42 37}, 17 #{20 1 21 33 22 41 25 23 19 57 9 16 18 49}, 3 #{0 7 59 27 1 4 43 6 51 2 35 19 11 5}, 12 #{20 60 4 15 13 36 44 28 11 9 14 10 52 8}, 2 #{0 7 58 1 4 50 6 34 3 5 26 10 18 42}, 23 #{7 20 55 39 15 21 31 22 17 47 19 16 18 63}, 47 #{7 55 39 46 15 31 40 41 43 44 23 45 42 63}, 35 #{59 27 39 32 33 36 43 51 34 3 19 11 38 37}, 19 #{59 20 27 21 22 43 51 17 3 23 35 11 16 18}, 57 #{62 59 58 60 1 56 33 41 61 25 17 9 63 49}, 11 #{59 27 15 13 43 51 3 12 35 19 9 14 10 8}, 9 #{1 15 33 13 41 25 17 12 57 11 14 10 8 49}, 5 #{0 7 1 4 21 13 61 29 6 3 2 45 53 37}, 14 #{62 46 54 15 13 22 6 12 11 9 38 30 10 8}, 45 #{46 21 40 13 41 43 61 29 44 47 5 53 42 37}, 53 #{55 54 48 50 21 13 61 29 51 5 45 52 37 49}, 26 #{58 27 24 50 31 29 28 25 34 2 30 10 18 42}, 16 #{0 20 24 48 21 32 40 56 22 17 23 19 18 8}, 38 #{62 39 46 54 32 33 22 36 6 34 35 14 30 37}, 30 #{62 27 24 46 54 31 22 29 6 28 25 14 26 38}, 10 #{58 15 50 13 34 12 2 11 9 14 26 18 42 8}, 18 #{20 58 50 21 22 34 17 2 23 19 26 16 10 42}, 52 #{20 60 55 4 54 48 50 36 44 28 51 12 53 49}, 42 #{58 46 50 40 41 43 44 34 2 47 45 26 10 18}, 37 #{39 21 32 33 13 36 61 29 34 35 5 45 53 38}, 63 #{62 7 59 58 60 55 39 15 31 56 61 23 47 57}, 8 #{0 24 15 48 32 40 56 13 12 11 9 14 16 10}, 49 #{1 55 54 48 50 33 41 51 25 17 57 9 53 52}}))

(def bishop-positions (quote {0 #{27 54 36 9 45 18 63}, 62 #{55 44 17 35 53 26 8}, 7 #{21 56 28 35 14 42 49}, 59 #{50 31 32 41 45 38 52}, 20 #{27 48 13 41 29 6 34 2 47 11 38}, 58 #{40 44 51 23 30 37 49}, 60 #{24 39 46 33 51 53 42}, 27 #{0 20 54 48 13 36 41 6 34 9 45 18 63}, 1 #{55 46 28 19 10 37 8}, 24 #{60 33 51 17 3 10 42}, 55 #{62 1 46 28 19 10 37}, 39 #{60 46 21 3 12 53 30}, 46 #{60 1 55 39 28 19 53 10 37}, 4 #{31 32 13 22 25 11 18}, 54 #{0 27 36 61 47 9 45 18 63}, 15 #{50 22 36 43 29 6 57}, 48 #{20 27 13 41 6 34 57}, 50 #{59 15 32 22 36 41 43 29 57}, 21 #{7 39 56 28 3 12 35 14 30 42 49}, 31 #{59 4 13 22 45 38 52}, 32 #{59 4 50 41 25 11 18}, 40 #{58 33 12 19 5 26 49}, 56 #{7 21 28 35 14 42 49}, 33 #{60 24 40 51 12 19 5 26 42}, 13 #{20 27 4 48 31 22 41 6 34}, 22 #{4 15 50 31 13 36 43 29 57}, 36 #{0 27 54 15 50 22 43 29 57 9 45 18 63}, 41 #{59 20 27 48 50 32 13 6 34}, 43 #{15 50 22 36 61 29 25 34 57 16 52}, 61 #{54 43 25 34 47 16 52}, 29 #{20 15 50 22 36 43 2 47 57 11 38}, 44 #{62 58 51 17 23 35 53 26 30 37 8}, 6 #{20 27 15 48 13 41 34}, 28 #{7 1 55 46 21 56 35 19 14 10 42 37 49}, 51 #{58 60 24 33 44 23 30 42 37}, 25 #{4 32 43 61 34 11 16 18 52}, 34 #{20 27 48 13 41 43 61 6 25 16 52}, 17 #{62 24 44 3 35 53 26 10 8}, 3 #{24 39 21 17 12 30 10}, 12 #{39 21 40 33 3 19 5 26 30}, 2 #{20 29 47 11 9 16 38}, 23 #{58 44 51 5 14 30 37}, 47 #{20 54 61 29 2 11 38}, 35 #{62 7 21 56 44 28 17 14 53 26 42 8 49}, 19 #{1 55 46 40 33 28 12 5 26 10 37}, 57 #{15 48 50 22 36 43 29}, 11 #{20 4 32 29 25 2 47 38 18}, 9 #{0 27 54 36 2 45 16 18 63}, 5 #{40 33 12 23 19 14 26}, 14 #{7 21 56 28 23 35 5 42 49}, 45 #{0 59 27 54 31 36 9 38 18 52 63}, 53 #{62 60 39 46 44 17 35 26 8}, 26 #{62 40 33 44 17 12 35 19 5 53 8}, 16 #{43 61 25 34 2 9 52}, 38 #{59 20 31 29 2 47 11 45 52}, 30 #{58 39 21 44 51 3 12 23 37}, 10 #{1 24 55 46 28 17 3 19 37}, 18 #{0 27 4 54 32 36 25 11 9 45 63}, 52 #{59 31 43 61 25 34 45 16 38}, 42 #{7 60 24 21 56 33 28 51 35 14 49}, 37 #{58 1 55 46 44 28 51 23 19 30 10}, 63 #{0 27 54 36 9 45 18}, 8 #{62 1 44 17 35 53 26}, 49 #{7 58 21 40 56 28 35 14 42}}))

(def queen-positions (quote {0 #{7 27 1 24 4 54 48 32 40 56 36 6 3 2 9 5 45 16 18 63 8}, 62 #{59 58 60 55 46 54 56 22 61 44 6 17 35 57 14 53 26 38 30 63 8}, 7 #{0 1 55 39 4 15 21 31 56 6 28 3 2 23 47 35 5 14 42 63 49}, 59 #{62 58 60 27 50 31 32 56 41 43 61 51 3 35 19 57 11 45 38 52 63}, 20 #{60 27 4 48 21 13 22 36 41 29 44 6 28 34 17 12 2 23 47 19 11 16 38 18 52}, 58 #{62 59 60 50 40 56 61 44 51 34 2 23 57 26 30 10 18 42 37 63 49}, 60 #{62 59 20 58 24 39 46 4 56 33 36 61 44 28 51 12 57 53 52 42 63}, 27 #{0 59 20 24 54 48 31 13 36 41 43 29 6 28 51 25 34 3 35 19 11 9 45 26 30 18 63}, 1 #{0 7 55 46 4 33 41 6 28 25 17 3 2 19 57 9 5 10 37 8 49}, 24 #{0 60 27 48 31 32 40 56 33 29 28 51 25 17 3 26 16 30 10 42 8}, 55 #{62 7 1 39 46 54 15 48 50 31 28 51 23 47 19 53 10 52 37 63 49}, 39 #{7 60 55 46 15 21 31 32 33 36 34 3 12 23 47 35 53 38 30 37 63}, 46 #{62 60 1 55 39 54 40 22 41 43 44 6 28 47 19 14 45 53 38 30 10 42 37}, 4 #{0 7 20 60 1 31 32 13 22 36 44 6 28 25 3 12 2 11 5 18 52}, 54 #{0 62 27 55 46 48 50 22 36 61 6 51 47 9 14 45 53 38 30 18 52 63 49}, 15 #{7 55 39 50 31 13 22 36 43 29 6 12 23 47 57 11 9 14 10 63 8}, 48 #{0 20 27 24 55 54 50 32 40 56 13 41 6 51 34 57 53 16 52 8 49}, 50 #{59 58 55 54 15 48 32 22 36 41 43 29 51 34 2 57 53 26 10 18 52 42 49}, 21 #{7 20 39 56 13 22 61 29 28 17 3 12 23 35 19 5 14 45 53 16 30 18 42 37 49}, 31 #{7 59 27 24 55 39 4 15 13 22 29 28 25 23 47 45 26 38 30 52 63}, 32 #{0 59 24 39 4 48 50 40 56 33 36 41 25 34 35 11 16 38 18 37 8}, 40 #{0 58 24 46 48 32 56 33 41 43 44 12 47 19 5 45 26 16 42 8 49}, 56 #{0 62 7 59 58 60 24 48 21 32 40 61 28 35 57 14 16 42 63 8 49}, 33 #{60 1 24 39 32 40 36 41 51 25 34 17 12 35 19 57 9 5 26 38 42 37 49}, 13 #{20 27 4 15 48 21 31 22 41 61 29 6 34 12 11 9 5 14 45 53 10 37 8}, 22 #{62 20 46 4 54 15 50 21 31 13 36 43 29 6 17 23 19 57 14 16 38 30 18}, 36 #{0 20 60 27 39 4 54 15 50 32 33 22 43 29 44 28 34 12 35 57 9 45 38 18 52 37 63}, 41 #{59 20 27 1 46 48 50 32 40 33 13 43 44 6 25 34 17 47 57 9 45 42 49}, 43 #{59 27 46 15 50 40 22 36 41 61 29 44 51 25 34 3 47 35 19 57 11 45 16 52 42}, 61 #{62 59 58 60 54 21 56 13 43 29 25 34 47 57 5 45 53 16 52 37 63}, 29 #{20 27 24 15 50 21 31 13 22 36 43 61 28 25 2 47 57 11 5 45 53 26 38 30 37}, 44 #{62 20 58 60 46 4 40 36 41 43 28 51 17 12 23 47 35 45 53 26 30 52 42 37 8}, 6 #{0 62 7 20 27 1 46 4 54 15 48 13 22 41 34 3 2 5 14 38 30}, 28 #{7 20 60 27 1 24 55 46 4 21 31 56 36 29 44 25 12 35 19 14 26 30 10 52 42 37 49}, 51 #{59 58 60 27 24 55 54 48 50 33 43 44 3 23 35 19 11 53 30 52 42 37 49}, 25 #{27 1 24 4 31 32 33 41 43 61 29 28 34 17 57 11 9 26 16 30 18 52 49}, 34 #{20 58 27 39 48 50 32 33 13 36 41 43 61 6 25 2 35 26 16 38 10 18 52 42 37}, 17 #{62 20 1 24 21 33 22 41 44 25 3 23 35 19 57 9 53 26 16 10 18 8 49}, 3 #{0 7 59 27 1 24 39 4 21 43 6 51 17 12 2 35 19 11 5 30 10}, 12 #{20 60 39 4 15 21 40 33 13 36 44 28 3 19 11 9 5 14 26 30 10 52 8}, 2 #{0 7 20 58 1 4 50 29 6 34 3 47 11 9 5 26 16 38 10 18 42}, 23 #{7 20 58 55 39 15 21 31 22 44 51 17 47 19 5 14 16 30 18 37 63}, 47 #{7 20 55 39 46 54 15 31 40 41 43 61 29 44 2 23 11 45 38 42 63}, 35 #{62 7 59 27 39 21 32 56 33 36 43 44 28 51 34 17 3 19 11 14 53 26 38 42 37 8 49}, 19 #{59 20 27 1 55 46 21 40 33 22 43 28 51 17 3 12 23 35 11 5 26 16 10 18 37}, 57 #{62 59 58 60 1 15 48 50 56 33 22 36 41 43 61 29 25 17 9 63 49}, 11 #{59 20 27 4 15 32 13 43 29 51 25 3 12 2 47 35 19 9 14 38 10 18 8}, 9 #{0 27 1 54 15 33 13 36 41 25 17 12 2 57 11 14 45 16 10 18 63 8 49}, 5 #{0 7 1 4 21 40 33 13 61 29 6 3 12 2 23 19 14 45 53 26 37}, 14 #{62 7 46 54 15 21 56 13 22 6 28 12 23 35 11 9 5 38 30 10 42 8 49}, 45 #{0 59 27 46 54 21 31 40 13 36 41 43 61 29 44 47 9 5 53 38 18 52 42 37 63}, 53 #{62 60 55 39 46 54 48 50 21 13 61 29 44 51 17 35 5 45 26 52 37 8 49}, 26 #{62 58 27 24 50 31 40 33 29 44 28 25 34 17 12 2 35 19 5 53 30 10 18 42 8}, 16 #{0 20 24 48 21 32 40 56 22 43 61 25 34 17 2 23 19 9 18 52 8}, 38 #{62 59 20 39 46 54 31 32 33 22 36 29 6 34 2 47 35 11 14 45 30 52 37}, 30 #{62 58 27 24 39 46 54 21 31 22 29 44 6 28 51 25 3 12 23 14 26 38 37}, 10 #{58 1 24 55 46 15 50 13 28 34 17 3 12 2 19 11 9 14 26 18 42 37 8}, 18 #{0 20 58 27 4 54 50 21 32 22 36 25 34 17 2 23 19 11 9 45 26 16 10 42 63}, 52 #{59 20 60 55 4 54 48 50 31 36 43 61 44 28 51 25 34 12 45 53 16 38 49}, 42 #{7 58 60 24 46 50 21 40 56 33 41 43 44 28 51 34 2 47 35 14 45 26 10 18 49}, 37 #{58 1 55 39 46 21 32 33 13 36 61 29 44 28 51 34 23 35 19 5 45 53 38 30 10}, 63 #{0 62 7 59 58 60 27 55 39 54 15 31 56 36 61 23 47 57 9 45 18}, 8 #{0 62 1 24 15 48 32 40 56 13 44 17 12 35 11 9 14 53 26 16 10}, 49 #{7 58 1 55 54 48 50 21 40 56 33 41 28 51 25 17 35 57 9 14 53 52 42}}))

(defn map-ranks [f ranks] (into {} (mapcat (fn [rank] (map (fn [file] [(file+rank->index [file rank]) #{(file+rank->index [file (f rank)])}]) (range 0 8))) ranks)))

(def black-pawn-double-push (quote {48 #{32}, 49 #{33}, 50 #{34}, 51 #{35}, 52 #{36}, 53 #{37}, 54 #{38}, 55 #{39}}))

(def black-pawn-positions (quote {20 #{12}, 27 #{19}, 24 #{16}, 55 #{39 47}, 39 #{31}, 46 #{38}, 54 #{46 38}, 15 #{7}, 48 #{32 40}, 50 #{34 42}, 21 #{13}, 31 #{23}, 32 #{24}, 40 #{32}, 33 #{25}, 13 #{5}, 22 #{14}, 36 #{28}, 41 #{33}, 43 #{35}, 29 #{21}, 44 #{36}, 28 #{20}, 51 #{43 35}, 25 #{17}, 34 #{26}, 17 #{9}, 12 #{4}, 23 #{15}, 47 #{39}, 35 #{27}, 19 #{11}, 11 #{3}, 9 #{1}, 14 #{6}, 45 #{37}, 53 #{45 37}, 26 #{18}, 16 #{8}, 38 #{30}, 30 #{22}, 10 #{2}, 18 #{10}, 52 #{36 44}, 42 #{34}, 37 #{29}, 8 #{0}, 49 #{33 41}}))

(def white-pawn-double-push (quote {8 #{24}, 9 #{25}, 10 #{26}, 11 #{27}, 12 #{28}, 13 #{29}, 14 #{30}, 15 #{31}}))

(def white-pawn-positions (quote {20 #{28}, 27 #{35}, 24 #{32}, 55 #{63}, 39 #{47}, 46 #{54}, 54 #{62}, 15 #{31 23}, 48 #{56}, 50 #{58}, 21 #{29}, 31 #{39}, 32 #{40}, 40 #{48}, 33 #{41}, 13 #{21 29}, 22 #{30}, 36 #{44}, 41 #{49}, 43 #{51}, 29 #{37}, 44 #{52}, 28 #{36}, 51 #{59}, 25 #{33}, 34 #{42}, 17 #{25}, 12 #{20 28}, 23 #{31}, 47 #{55}, 35 #{43}, 19 #{27}, 11 #{27 19}, 9 #{25 17}, 14 #{22 30}, 45 #{53}, 53 #{61}, 26 #{34}, 16 #{24}, 38 #{46}, 30 #{38}, 10 #{26 18}, 18 #{26}, 52 #{60}, 42 #{50}, 37 #{45}, 8 #{24 16}, 49 #{57}}))

(def possible-moves {:bP black-pawn-positions, :bN knight-positions, :wK king-positions, :bQ queen-positions, :wN knight-positions, :bK king-positions, :wQ queen-positions, :wB bishop-positions, :wR rook-positions, :wP white-pawn-positions, :bB bishop-positions, :bR rook-positions})

(get-in possible-moves [:wB 5])

(get bishop-positions 5)

(def black-pawn-captures (quote {0 #{}, 62 #{55 53}, 7 #{}, 59 #{50 52}, 20 #{13 11}, 58 #{51 49}, 60 #{51 53}, 27 #{20 18}, 1 #{}, 24 #{17}, 55 #{46}, 39 #{30}, 46 #{39 37}, 4 #{}, 54 #{47 45}, 15 #{6}, 48 #{41}, 50 #{41 43}, 21 #{12 14}, 31 #{22}, 32 #{25}, 40 #{33}, 56 #{49}, 33 #{24 26}, 13 #{4 6}, 22 #{15 13}, 36 #{27 29}, 41 #{32 34}, 43 #{36 34}, 61 #{54 52}, 29 #{20 22}, 44 #{35 37}, 6 #{}, 28 #{21 19}, 51 #{44 42}, 25 #{16 18}, 34 #{27 25}, 17 #{10 8}, 3 #{}, 12 #{3 5}, 2 #{}, 23 #{14}, 47 #{38}, 35 #{28 26}, 19 #{12 10}, 57 #{48 50}, 11 #{4 2}, 9 #{0 2}, 5 #{}, 14 #{7 5}, 45 #{36 38}, 53 #{46 44}, 26 #{17 19}, 16 #{9}, 38 #{31 29}, 30 #{21 23}, 10 #{1 3}, 18 #{11 9}, 52 #{43 45}, 42 #{33 35}, 37 #{28 30}, 63 #{54}, 8 #{1}, 49 #{40 42}}))

(def white-pawn-captures (quote {0 #{9}, 62 #{}, 7 #{14}, 59 #{}, 20 #{27 29}, 58 #{}, 60 #{}, 27 #{36 34}, 1 #{10 8}, 24 #{33}, 55 #{62}, 39 #{46}, 46 #{55 53}, 4 #{13 11}, 54 #{61 63}, 15 #{22}, 48 #{57}, 50 #{59 57}, 21 #{28 30}, 31 #{38}, 32 #{41}, 40 #{49}, 56 #{}, 33 #{40 42}, 13 #{20 22}, 22 #{31 29}, 36 #{43 45}, 41 #{48 50}, 43 #{50 52}, 61 #{}, 29 #{36 38}, 44 #{51 53}, 6 #{15 13}, 28 #{35 37}, 51 #{58 60}, 25 #{32 34}, 34 #{41 43}, 17 #{24 26}, 3 #{12 10}, 12 #{21 19}, 2 #{11 9}, 23 #{30}, 47 #{54}, 35 #{44 42}, 19 #{28 26}, 57 #{}, 11 #{20 18}, 9 #{16 18}, 5 #{12 14}, 14 #{21 23}, 45 #{54 52}, 53 #{62 60}, 26 #{33 35}, 16 #{25}, 38 #{47 45}, 30 #{39 37}, 10 #{17 19}, 18 #{27 25}, 52 #{59 61}, 42 #{51 49}, 37 #{46 44}, 63 #{}, 8 #{17}, 49 #{58 56}}))

(def capture-moves (assoc possible-moves :wB bishop-positions :wR rook-positions :wQ queen-positions :wP white-pawn-captures :bB bishop-positions :bR rook-positions :bQ queen-positions :bP black-pawn-captures))

(defn find-king-positions [board] (reduce (fn [acc pos] (switch (nth board pos) :wK (if (= (count acc) 1) (reduced (assoc acc :w pos)) {:w pos}) :bK (if (= (count acc) 1) (reduced (assoc acc :b pos)) {:b pos}) acc)) {} all-positions))

(defn castling->str [castling] (if (empty? castling) "-" (str (if (contains? castling white-kingside-castling) \K "") (if (contains? castling white-queenside-castling) \Q "") (if (contains? castling black-kingside-castling) \k "") (if (contains? castling black-queenside-castling) \q ""))))

(defn str->castling [s] (into #{} (keep (fn [p] (switch p \K white-kingside-castling \Q white-queenside-castling \k black-kingside-castling \q black-queenside-castling nil)) (vec s))))

(defn fen->state [fen] (let [[placement side castling ep-coord half full] (split fen " ") board (board-str->board-vec placement) side (switch side "b" :b :w)] {:board board, :side side, :king-positions (find-king-positions board), :ep (switch ep-coord "-" #{} (calculate-ep-from side ep-coord)), :castling (str->castling castling)}))

(defn index->file [idx] (rem idx 8))

(defn index->rank [idx] (quot idx 8))

(defn rank->index [r] (* r 8))

(defn direction [[x y] [x1 y1]] (let [dir-x (- x1 x) dir-y (- y1 y)] [dir-x dir-y] (cond (zero? dir-x) (cond (pos? dir-y) [0 1] (neg? dir-y) [0 -1]) (zero? dir-y) (cond (pos? dir-x) [1 0] (neg? dir-x) [-1 0]) (= (abs dir-x) (abs dir-y)) [(long (signum dir-x)) (long (signum dir-y))])))

(defn betweens [a b] (let [[x y] a] (when-let [dir (direction a b)] (not-empty (into [] (take-while (partial not= b) (map (fn [[xd yd]] [(+ x xd) (+ y yd)]) (ray dir))))))))

(defn between-tiles? [a b c] (let [a (coord->file+rank a) b (coord->file+rank b) c (coord->file+rank c)] (contains? (set (betweens a b)) c)))

(def tiles-between (quote {[26 44] [35], [42 21] [35 28], [43 29] [36], [35 7] [28 21 14], [62 44] [53], [55 53] [54], [49 35] [42], [8 48] [16 24 32 40], [43 40] [42 41], [42 46] [43 44 45], [36 9] [27 18], [35 11] [27 19], [21 18] [20 19], [8 11] [9 10], [59 3] [51 43 35 27 19 11], [16 19] [17 18], [3 39] [12 21 30], [53 49] [52 51 50], [62 8] [53 44 35 26 17], [17 49] [25 33 41], [48 53] [49 50 51 52], [42 24] [33], [27 45] [36], [13 37] [21 29], [44 20] [36 28], [38 59] [45 52], [7 1] [6 5 4 3 2], [19 33] [26], [9 49] [17 25 33 41], [8 26] [17], [35 14] [28 21], [21 61] [29 37 45 53], [6 38] [14 22 30], [50 48] [49], [10 14] [11 12 13], [35 37] [36], [5 19] [12], [38 35] [37 36], [36 20] [28], [2 18] [10], [21 42] [28 35], [1 46] [10 19 28 37], [36 18] [27], [23 63] [31 39 47 55], [27 9] [18], [18 23] [19 20 21 22], [38 32] [37 36 35 34 33], [42 56] [49], [27 59] [35 43 51], [31 52] [38 45], [32 59] [41 50], [7 23] [15], [56 59] [57 58], [1 25] [9 17], [15 39] [23 31], [52 16] [43 34 25], [30 54] [38 46], [23 5] [14], [25 52] [34 43], [1 33] [9 17 25], [16 61] [25 34 43 52], [41 27] [34], [16 34] [25], [13 15] [14], [15 11] [14 13 12], [48 8] [40 32 24 16], [63 57] [62 61 60 59 58], [43 27] [35], [10 34] [18 26], [11 9] [10], [10 37] [19 28], [9 25] [17], [27 63] [36 45 54], [36 12] [28 20], [32 37] [33 34 35 36], [25 31] [26 27 28 29 30], [58 37] [51 44], [6 41] [13 20 27 34], [24 42] [33], [14 30] [22], [47 45] [46], [47 2] [38 29 20 11], [52 4] [44 36 28 20 12], [18 32] [25], [30 51] [37 44], [16 32] [24], [48 51] [49 50], [46 14] [38 30 22], [41 9] [33 25 17], [57 22] [50 43 36 29], [61 37] [53 45], [19 16] [18 17], [21 7] [14], [41 13] [34 27 20], [44 46] [45], [36 33] [35 34], [25 1] [17 9], [27 41] [34], [32 39] [33 34 35 36 37 38], [5 53] [13 21 29 37 45], [34 13] [27 20], [41 45] [42 43 44], [40 5] [33 26 19 12], [24 56] [32 40 48], [13 8] [12 11 10 9], [52 28] [44 36], [27 29] [28], [23 19] [22 21 20], [61 5] [53 45 37 29 21 13], [7 21] [14], [3 19] [11], [37 34] [36 35], [27 3] [19 11], [56 14] [49 42 35 28 21], [10 15] [11 12 13 14], [39 12] [30 21], [33 38] [34 35 36 37], [40 46] [41 42 43 44 45], [46 62] [54], [0 56] [8 16 24 32 40 48], [23 58] [30 37 44 51], [4 52] [12 20 28 36 44], [3 59] [11 19 27 35 43 51], [47 7] [39 31 23 15], [30 14] [22], [58 23] [51 44 37 30], [2 5] [3 4], [7 2] [6 5 4 3], [46 30] [38], [57 15] [50 43 36 29 22], [44 58] [51], [58 62] [59 60 61], [22 17] [21 20 19 18], [15 55] [23 31 39 47], [10 13] [11 12], [39 60] [46 53], [29 15] [22], [34 52] [43], [47 31] [39], [56 8] [48 40 32 24 16], [45 29] [37], [51 37] [44], [63 56] [62 61 60 59 58 57], [18 0] [9], [30 27] [29 28], [8 53] [17 26 35 44], [37 51] [44], [61 63] [62], [38 36] [37], [19 59] [27 35 43 51], [56 0] [48 40 32 24 16 8], [33 5] [26 19 12], [15 12] [14 13], [37 13] [29 21], [20 18] [19], [48 55] [49 50 51 52 53 54], [4 32] [11 18 25], [32 8] [24 16], [3 35] [11 19 27], [9 54] [18 27 36 45], [37 39] [38], [12 14] [13], [15 47] [23 31 39], [26 10] [18], [7 4] [6 5], [56 62] [57 58 59 60 61], [55 39] [47], [12 36] [20 28], [35 8] [26 17], [9 15] [10 11 12 13 14], [54 27] [45 36], [12 40] [19 26 33], [37 61] [45 53], [57 25] [49 41 33], [34 48] [41], [0 6] [1 2 3 4 5], [32 34] [33], [46 6] [38 30 22 14], [40 45] [41 42 43 44], [31 4] [22 13], [60 33] [51 42], [26 31] [27 28 29 30], [36 60] [44 52], [28 56] [35 42 49], [43 11] [35 27 19], [28 10] [19], [37 5] [29 21 13], [46 41] [45 44 43 42], [22 20] [21], [10 8] [9], [31 26] [30 29 28 27], [25 30] [26 27 28 29], [18 2] [10], [6 3] [5 4], [48 24] [40 32], [57 60] [58 59], [52 55] [53 54], [31 59] [38 45 52], [18 58] [26 34 42 50], [38 2] [29 20 11], [21 3] [12], [58 40] [49], [31 45] [38], [53 8] [44 35 26 17], [5 37] [13 21 29], [0 5] [1 2 3 4], [60 4] [52 44 36 28 20 12], [56 21] [49 42 35 28], [57 36] [50 43], [14 28] [21], [25 27] [26], [57 33] [49 41], [40 24] [32], [32 38] [33 34 35 36 37], [23 55] [31 39 47], [44 12] [36 28 20], [4 25] [11 18], [32 18] [25], [35 38] [36 37], [50 53] [51 52], [59 56] [58 57], [11 14] [12 13], [28 14] [21], [60 20] [52 44 36 28], [27 25] [26], [19 22] [20 21], [12 8] [11 10 9], [63 39] [55 47], [17 23] [18 19 20 21 22], [12 44] [20 28 36], [28 1] [19 10], [36 39] [37 38], [41 17] [33 25], [63 45] [54], [0 40] [8 16 24 32], [7 3] [6 5 4], [22 18] [21 20 19], [35 32] [34 33], [23 51] [30 37 44], [34 61] [43 52], [16 43] [25 34], [17 57] [25 33 41 49], [24 0] [16 8], [43 22] [36 29], [51 55] [52 53 54], [40 56] [48], [55 50] [54 53 52 51], [38 52] [45], [22 38] [30], [47 61] [54], [44 62] [53], [25 61] [34 43 52], [31 25] [30 29 28 27 26], [39 3] [30 21 12], [36 57] [43 50], [26 8] [17], [31 29] [30], [12 39] [21 30], [45 5] [37 29 21 13], [15 9] [14 13 12 11 10], [0 48] [8 16 24 32 40], [17 1] [9], [48 32] [40], [18 34] [26], [5 33] [12 19 26], [62 14] [54 46 38 30 22], [59 38] [52 45], [4 2] [3], [34 58] [42 50], [0 18] [9], [37 1] [28 19 10], [58 60] [59], [12 60] [20 28 36 44 52], [16 40] [24 32], [47 41] [46 45 44 43 42], [36 4] [28 20 12], [20 16] [19 18 17], [14 56] [21 28 35 42 49], [60 46] [53], [57 43] [50], [33 19] [26], [22 62] [30 38 46 54], [7 56] [14 21 28 35 42 49], [11 25] [18], [35 17] [26], [14 54] [22 30 38 46], [51 11] [43 35 27 19], [34 16] [25], [28 44] [36], [13 41] [20 27 34], [42 26] [34], [51 54] [52 53], [31 15] [23], [18 42] [26 34], [40 43] [41 42], [61 21] [53 45 37 29], [3 0] [2 1], [12 28] [20], [48 16] [40 32 24], [58 63] [59 60 61 62], [59 19] [51 43 35 27], [63 58] [62 61 60 59], [42 60] [51], [43 3] [35 27 19 11], [15 43] [22 29 36], [49 53] [50 51 52], [19 23] [20 21 22], [43 59] [51], [11 13] [12], [54 14] [46 38 30 22], [51 24] [42 33], [43 46] [44 45], [13 9] [12 11 10], [63 47] [55], [44 17] [35 26], [2 47] [11 20 29 38], [1 37] [10 19 28], [50 10] [42 34 26 18], [44 60] [52], [42 58] [50], [43 25] [34], [29 61] [37 45 53], [16 2] [9], [56 28] [49 42 35], [26 2] [18 10], [54 0] [45 36 27 18 9], [15 31] [23], [8 62] [17 26 35 44 53], [3 30] [12 21], [48 13] [41 34 27 20], [44 41] [43 42], [49 17] [41 33 25], [13 45] [21 29 37], [25 57] [33 41 49], [22 46] [30 38], [36 54] [45], [40 0] [32 24 16 8], [59 61] [60], [15 57] [22 29 36 43 50], [60 39] [53 46], [8 10] [9], [52 54] [53], [5 3] [4], [18 4] [11], [35 51] [43], [54 50] [53 52 51], [49 25] [41 33], [37 23] [30], [38 62] [46 54], [34 32] [33], [46 42] [45 44 43], [35 3] [27 19 11], [62 30] [54 46 38], [30 6] [22 14], [28 4] [20 12], [11 47] [20 29 38], [58 56] [57], [62 57] [61 60 59 58], [2 20] [11], [54 48] [53 52 51 50 49], [39 32] [38 37 36 35 34 33], [9 12] [10 11], [62 6] [54 46 38 30 22 14], [61 16] [52 43 34 25], [24 40] [32], [7 35] [14 21 28], [4 44] [12 20 28 36], [28 46] [37], [40 19] [33 26], [20 41] [27 34], [61 45] [53], [19 43] [27 35], [35 21] [28], [24 28] [25 26 27], [60 44] [52], [36 15] [29 22], [0 24] [8 16], [56 61] [57 58 59 60], [37 10] [28 19], [4 7] [5 6], [24 3] [17 10], [6 62] [14 22 30 38 46 54], [37 53] [45], [41 57] [49], [20 22] [21], [47 44] [46 45], [49 52] [50 51], [61 47] [54], [48 50] [49], [23 20] [22 21], [26 24] [25], [5 29] [13 21], [42 40] [41], [14 46] [22 30 38], [43 19] [35 27], [26 50] [34 42], [14 62] [22 30 38 46 54], [62 59] [61 60], [28 52] [36 44], [62 22] [54 46 38 30], [43 61] [52], [40 42] [41], [39 33] [38 37 36 35 34], [57 1] [49 41 33 25 17 9], [10 50] [18 26 34 42], [42 10] [34 26 18], [51 53] [52], [59 62] [60 61], [29 43] [36], [31 24] [30 29 28 27 26 25], [42 14] [35 28 21], [38 6] [30 22 14], [63 23] [55 47 39 31], [18 50] [26 34 42], [37 35] [36], [12 33] [19 26], [49 1] [41 33 25 17 9], [3 17] [10], [17 53] [26 35 44], [60 57] [59 58], [7 47] [15 23 31 39], [31 7] [23 15], [55 48] [54 53 52 51 50 49], [44 40] [43 42 41], [8 56] [16 24 32 40 48], [54 6] [46 38 30 22 14], [3 43] [11 19 27 35], [5 40] [12 19 26 33], [19 1] [10], [28 31] [29 30], [59 43] [51], [47 42] [46 45 44 43], [40 26] [33], [12 30] [21], [60 56] [59 58 57], [25 43] [34], [47 63] [55], [28 60] [36 44 52], [40 8] [32 24 16], [45 59] [52], [40 44] [41 42 43], [56 16] [48 40 32 24], [63 18] [54 45 36 27], [44 47] [45 46], [23 16] [22 21 20 19 18 17], [50 15] [43 36 29 22], [24 31] [25 26 27 28 29 30], [44 30] [37], [38 14] [30 22], [32 36] [33 34 35], [62 38] [54 46], [16 23] [17 18 19 20 21 22], [45 42] [44 43], [4 1] [3 2], [56 63] [57 58 59 60 61 62], [5 2] [4 3], [30 44] [37], [63 31] [55 47 39], [8 40] [16 24 32], [3 21] [12], [61 43] [52], [37 58] [44 51], [29 47] [38], [12 26] [19], [16 22] [17 18 19 20 21], [32 4] [25 18 11], [4 6] [5], [54 52] [53], [59 35] [51 43], [60 36] [52 44], [30 25] [29 28 27 26], [33 9] [25 17], [27 6] [20 13], [1 4] [2 3], [6 22] [14], [27 0] [18 9], [9 27] [18], [21 19] [20], [11 8] [10 9], [50 26] [42 34], [50 34] [42], [60 42] [51], [5 7] [6], [22 16] [21 20 19 18 17], [44 28] [36], [59 27] [51 43 35], [47 11] [38 29 20], [48 54] [49 50 51 52 53], [51 23] [44 37 30], [39 21] [30], [27 54] [36 45], [33 37] [34 35 36], [33 1] [25 17 9], [58 44] [51], [1 28] [10 19], [48 6] [41 34 27 20 13], [27 13] [20], [55 37] [46], [42 45] [43 44], [29 2] [20 11], [2 34] [10 18 26], [30 26] [29 28 27], [1 57] [9 17 25 33 41 49], [4 18] [11], [5 26] [12 19], [16 0] [8], [44 23] [37 30], [60 63] [61 62], [34 39] [35 36 37 38], [18 22] [19 20 21], [58 10] [50 42 34 26 18], [53 39] [46], [36 52] [44], [16 48] [24 32 40], [10 58] [18 26 34 42 50], [47 43] [46 45 44], [35 59] [43 51], [23 44] [30 37], [54 22] [46 38 30], [2 26] [10 18], [49 54] [50 51 52 53], [59 11] [51 43 35 27 19], [1 55] [10 19 28 37 46], [54 51] [53 52], [61 59] [60], [50 18] [42 34 26], [1 3] [2], [23 17] [22 21 20 19 18], [21 35] [28], [4 36] [12 20 28], [60 24] [51 42 33], [9 57] [17 25 33 41 49], [3 51] [11 19 27 35 43], [55 15] [47 39 31 23], [55 19] [46 37 28], [48 0] [40 32 24 16 8], [55 49] [54 53 52 51 50], [19 51] [27 35 43], [50 2] [42 34 26 18 10], [43 15] [36 29 22], [13 48] [20 27 34 41], [24 60] [33 42 51], [1 5] [2 3 4], [51 49] [50], [9 14] [10 11 12 13], [12 10] [11], [21 49] [28 35 42], [62 60] [61], [38 54] [46], [38 22] [30], [29 24] [28 27 26 25], [15 10] [14 13 12 11], [21 17] [20 19 18], [45 41] [44 43 42], [1 7] [2 3 4 5 6], [27 30] [28 29], [61 58] [60 59], [8 24] [16], [34 50] [42], [63 61] [62], [13 31] [22], [14 35] [21 28], [9 33] [17 25], [6 4] [5], [25 29] [26 27 28], [25 11] [18], [37 19] [28], [50 54] [51 52 53], [32 0] [24 16 8], [0 32] [8 16 24], [20 17] [19 18], [10 26] [18], [7 42] [14 21 28 35], [52 50] [51], [17 44] [26 35], [61 57] [60 59 58], [17 41] [25 33], [45 63] [54], [50 29] [43 36], [13 27] [20], [14 8] [13 12 11 10 9], [47 15] [39 31 23], [18 16] [17], [0 3] [1 2], [55 1] [46 37 28 19 10], [27 51] [35 43], [35 56] [42 49], [14 38] [22 30], [5 1] [4 3 2], [6 1] [5 4 3 2], [62 35] [53 44], [45 47] [46], [46 28] [37], [28 42] [35], [23 21] [22], [16 52] [25 34 43], [61 25] [52 43 34], [62 56] [61 60 59 58 57], [16 18] [17], [63 60] [62 61], [13 11] [12], [53 29] [45 37], [1 49] [9 17 25 33 41], [8 15] [9 10 11 12 13 14], [23 47] [31 39], [30 12] [21], [25 4] [18 11], [8 13] [9 10 11 12], [34 10] [26 18], [47 40] [46 45 44 43 42 41], [60 58] [59], [28 7] [21 14], [0 7] [1 2 3 4 5 6], [29 53] [37 45], [34 20] [27], [51 27] [43 35], [14 11] [13 12], [15 8] [14 13 12 11 10 9], [18 36] [27], [45 0] [36 27 18 9], [9 11] [10], [10 12] [11], [11 29] [20], [21 37] [29], [11 27] [19], [2 7] [3 4 5 6], [26 28] [27], [26 58] [34 42 50], [6 46] [14 22 30 38], [20 48] [27 34 41], [10 46] [19 28 37], [13 29] [21], [26 40] [33], [33 36] [34 35], [55 31] [47 39], [11 59] [19 27 35 43 51], [25 49] [33 41], [41 20] [34 27], [3 27] [11 19], [45 61] [53], [15 29] [22], [46 43] [45 44], [39 55] [47], [4 60] [12 20 28 36 44 52], [46 19] [37 28], [46 60] [53], [51 19] [43 35 27], [52 12] [44 36 28 20], [20 52] [28 36 44], [46 22] [38 30], [49 28] [42 35], [26 62] [35 44 53], [47 20] [38 29], [19 40] [26 33], [51 3] [43 35 27 19 11], [53 50] [52 51], [40 58] [49], [62 26] [53 44 35], [20 47] [29 38], [11 38] [20 29], [2 4] [3], [59 45] [52], [34 18] [26], [43 47] [44 45 46], [49 55] [50 51 52 53 54], [3 6] [4 5], [39 53] [46], [22 36] [29], [61 56] [60 59 58 57], [40 47] [41 42 43 44 45 46], [7 39] [15 23 31], [60 28] [52 44 36], [42 47] [43 44 45 46], [2 58] [10 18 26 34 42 50], [52 38] [45], [19 35] [27], [58 42] [50], [12 15] [13 14], [38 11] [29 20], [21 23] [22], [17 62] [26 35 44 53], [6 27] [13 20], [33 39] [34 35 36 37 38], [39 15] [31 23], [17 3] [10], [52 34] [43], [6 48] [13 20 27 34 41], [6 30] [14 22], [48 52] [49 50 51], [60 12] [52 44 36 28 20], [33 51] [42], [42 18] [34 26], [63 27] [54 45 36], [28 25] [27 26], [7 31] [15 23], [28 55] [37 46], [28 26] [27], [46 10] [37 28 19], [24 48] [32 40], [59 57] [58], [5 45] [13 21 29 37], [19 5] [12], [33 49] [41], [29 57] [36 43 50], [57 41] [49], [32 56] [40 48], [24 30] [25 26 27 28 29], [33 60] [42 51], [34 6] [27 20 13], [53 37] [45], [41 25] [33], [45 18] [36 27], [58 2] [50 42 34 26 18 10], [47 29] [38], [24 29] [25 26 27 28], [39 35] [38 37 36], [36 0] [27 18 9], [5 21] [13], [20 34] [27], [1 41] [9 17 25 33], [63 15] [55 47 39 31 23], [39 37] [38], [23 39] [31], [12 52] [20 28 36 44], [50 55] [51 52 53 54], [15 13] [14], [35 62] [44 53], [53 17] [44 35 26], [7 0] [6 5 4 3 2 1], [41 43] [42], [28 24] [27 26 25], [10 28] [19], [35 33] [34], [57 63] [58 59 60 61 62], [4 22] [13], [59 41] [50], [50 22] [43 36 29], [45 40] [44 43 42 41], [0 16] [8], [12 9] [11 10], [7 55] [15 23 31 39 47], [45 13] [37 29 21], [0 2] [1], [33 12] [26 19], [7 28] [14 21], [11 51] [19 27 35 43], [24 8] [16], [6 54] [14 22 30 38 46], [45 31] [38], [42 2] [34 26 18 10], [53 51] [52], [24 10] [17], [8 32] [16 24], [19 3] [11], [4 20] [12], [50 52] [51], [11 15] [12 13 14], [30 28] [29], [11 43] [19 27 35], [19 21] [20], [63 36] [54 45], [61 13] [53 45 37 29 21], [49 9] [41 33 25 17], [51 48] [50 49], [21 5] [13], [40 16] [32 24], [23 7] [15], [4 31] [13 22], [26 42] [34], [8 44] [17 26 35], [52 20] [44 36 28], [46 44] [45], [29 25] [28 27 26], [2 0] [1], [0 4] [1 2 3], [52 36] [44], [44 4] [36 28 20 12], [55 7] [47 39 31 23 15], [28 49] [35 42], [54 30] [46 38], [55 51] [54 53 52], [16 56] [24 32 40 48], [51 35] [43], [14 42] [21 28 35], [56 7] [49 42 35 28 21 14], [37 33] [36 35 34], [13 61] [21 29 37 45 53], [54 49] [53 52 51 50], [9 13] [10 11 12], [36 50] [43], [9 63] [18 27 36 45 54], [3 1] [2], [58 34] [50 42], [59 32] [50 41], [7 63] [15 23 31 39 47 55], [8 35] [17 26], [38 20] [29], [49 7] [42 35 28 21 14], [56 40] [48], [31 63] [39 47 55], [41 1] [33 25 17 9], [21 53] [29 37 45], [30 3] [21 12], [26 29] [27 28], [42 44] [43], [31 55] [39 47], [57 61] [58 59 60], [63 59] [62 61 60], [27 11] [19], [29 31] [30], [55 52] [54 53], [1 17] [9], [13 53] [21 29 37 45], [43 16] [34 25], [51 33] [42], [25 28] [26 27], [35 53] [44], [10 55] [19 28 37 46], [54 36] [45], [43 57] [50], [10 42] [18 26 34], [31 47] [39], [28 30] [29], [9 41] [17 25 33], [39 36] [38 37], [15 36] [22 29], [3 24] [10 17], [40 12] [33 26 19], [35 39] [36 37 38], [27 24] [26 25], [4 28] [12 20], [7 49] [14 21 28 35 42], [36 22] [29], [20 38] [29], [37 55] [46], [53 5] [45 37 29 21 13], [42 7] [35 28 21 14], [24 51] [33 42], [41 47] [42 43 44 45 46], [13 34] [20 27], [36 32] [35 34 33], [62 58] [61 60 59], [34 36] [35], [1 6] [2 3 4 5], [34 38] [35 36 37], [21 39] [30], [36 63] [45 54], [34 2] [26 18 10], [63 7] [55 47 39 31 23 15], [29 5] [21 13], [29 50] [36 43], [17 19] [18], [35 49] [42], [33 17] [25], [0 54] [9 18 27 36 45], [33 35] [34], [47 23] [39 31], [18 63] [27 36 45 54], [56 42] [49], [58 30] [51 44 37], [28 12] [20], [38 34] [37 36 35], [22 57] [29 36 43 50], [24 26] [25], [3 7] [4 5 6], [20 23] [21 22], [0 45] [9 18 27 36], [63 9] [54 45 36 27 18], [16 20] [17 18 19], [10 24] [17], [32 50] [41], [7 5] [6], [25 9] [17], [18 21] [19 20], [0 63] [9 18 27 36 45 54], [29 11] [20], [37 21] [29], [27 48] [34 41], [13 10] [12 11], [38 33] [37 36 35 34], [2 6] [3 4 5], [5 0] [4 3 2 1], [11 35] [19 27], [0 36] [9 18 27], [49 51] [50], [30 62] [38 46 54], [6 34] [13 20 27], [53 55] [54], [61 34] [52 43], [6 2] [5 4 3], [14 12] [13], [55 28] [46 37], [44 42] [43], [8 14] [9 10 11 12 13], [30 46] [38], [8 12] [9 10 11], [50 32] [41], [32 11] [25 18], [15 50] [22 29 36 43], [31 27] [30 29 28], [57 62] [58 59 60 61], [16 21] [17 18 19 20], [6 0] [5 4 3 2 1], [59 31] [52 45 38], [45 9] [36 27 18], [45 43] [44], [39 7] [31 23 15], [49 14] [42 35 28 21], [5 23] [14], [22 6] [14], [57 59] [58], [23 37] [30], [22 19] [21 20], [32 35] [33 34], [2 42] [10 18 26 34], [46 40] [45 44 43 42 41], [0 27] [9 18], [36 38] [37], [63 0] [54 45 36 27 18 9], [11 32] [18 25], [5 61] [13 21 29 37 45 53], [52 49] [51 50], [18 45] [27 36], [36 34] [35], [6 20] [13], [53 21] [45 37 29], [52 48] [51 50 49], [23 18] [22 21 20 19], [41 6] [34 27 20 13], [34 37] [35 36], [2 38] [11 20 29], [54 18] [45 36 27], [20 2] [11], [14 10] [13 12 11], [56 24] [48 40 32], [41 46] [42 43 44 45], [44 26] [35], [58 26] [50 42 34], [14 49] [21 28 35 42], [46 1] [37 28 19 10], [32 16] [24], [2 16] [9], [24 27] [25 26], [17 35] [26], [19 17] [18], [54 38] [46], [18 20] [19], [9 45] [18 27 36], [53 35] [44], [53 48] [52 51 50 49], [49 33] [41], [22 4] [13], [21 16] [20 19 18 17], [30 58] [37 44 51], [3 5] [4], [27 31] [28 29 30], [44 8] [35 26 17], [39 23] [31], [31 28] [30 29], [45 21] [37 29], [25 41] [33], [30 24] [29 28 27 26 25], [39 63] [47 55], [21 56] [28 35 42 49], [43 45] [44], [17 22] [18 19 20 21], [31 13] [22], [19 46] [28 37], [42 28] [35], [20 60] [28 36 44 52], [19 55] [28 37 46], [20 44] [28 36], [62 46] [54], [56 32] [48 40], [59 63] [60 61 62], [19 37] [28], [20 4] [12], [55 10] [46 37 28 19], [26 12] [19], [53 26] [44 35], [27 43] [35], [35 19] [27], [52 25] [43 34], [62 17] [53 44 35 26], [54 9] [45 36 27 18], [14 9] [13 12 11 10], [53 13] [45 37 29 21], [57 17] [49 41 33 25], [57 29] [50 43 36], [15 63] [23 31 39 47 55], [48 34] [41], [22 43] [29 36], [26 53] [35 44], [56 35] [49 42], [18 54] [27 36 45], [21 45] [29 37], [57 9] [49 41 33 25 17], [43 41] [42], [55 23] [47 39 31], [50 36] [43], [41 59] [50], [29 13] [21], [2 50] [10 18 26 34 42], [33 57] [41 49], [48 20] [41 34 27], [20 36] [28], [2 29] [11 20], [49 21] [42 35 28], [26 5] [19 12], [26 30] [27 28 29], [29 45] [37], [22 54] [30 38 46], [41 44] [42 43], [32 48] [40], [39 34] [38 37 36 35], [37 32] [36 35 34 33], [56 58] [57], [58 61] [59 60], [1 19] [10], [60 62] [61], [20 6] [13], [29 26] [28 27], [52 31] [45 38], [45 27] [36], [22 50] [29 36 43], [51 30] [44 37], [48 27] [41 34], [61 29] [53 45 37], [29 27] [28], [17 21] [18 19 20], [9 36] [18 27], [17 20] [18 19], [4 0] [3 2 1], [56 60] [57 58 59], [17 33] [25], [58 18] [50 42 34 26]}))

(def direction-between (quote {[26 44] [1 1], [42 21] [1 -1], [43 29] [1 -1], [35 7] [1 -1], [62 44] [-1 -1], [7 6] [-1 0], [55 53] [-1 0], [28 19] [-1 -1], [37 36] [-1 0], [49 35] [1 -1], [8 48] [0 1], [43 40] [-1 0], [38 30] [0 -1], [25 34] [1 1], [42 46] [1 0], [36 9] [-1 -1], [35 11] [0 -1], [21 18] [-1 0], [8 11] [1 0], [59 3] [0 -1], [16 19] [1 0], [3 39] [1 1], [53 49] [-1 0], [34 26] [0 -1], [62 8] [-1 -1], [50 59] [1 1], [17 49] [0 1], [48 53] [1 0], [42 24] [-1 -1], [27 45] [1 1], [13 37] [0 1], [44 20] [0 -1], [38 59] [-1 1], [9 8] [-1 0], [7 1] [-1 0], [17 25] [0 1], [19 33] [-1 1], [9 49] [0 1], [60 59] [-1 0], [8 26] [1 1], [35 14] [1 -1], [21 61] [0 1], [6 38] [0 1], [26 34] [0 1], [25 24] [-1 0], [50 48] [-1 0], [37 45] [0 1], [34 33] [-1 0], [27 19] [0 -1], [10 14] [1 0], [35 37] [1 0], [5 19] [-1 1], [38 35] [-1 0], [31 38] [-1 1], [8 9] [1 0], [36 20] [0 -1], [37 30] [1 -1], [2 18] [0 1], [21 42] [-1 1], [28 29] [1 0], [1 46] [1 1], [36 18] [-1 -1], [23 63] [0 1], [62 53] [-1 -1], [27 9] [-1 -1], [18 23] [1 0], [54 45] [-1 -1], [38 32] [-1 0], [42 56] [-1 1], [27 59] [0 1], [14 22] [0 1], [51 42] [-1 -1], [31 52] [-1 1], [32 59] [1 1], [35 28] [1 -1], [7 23] [0 1], [56 59] [1 0], [1 25] [0 1], [15 39] [0 1], [52 16] [-1 -1], [30 54] [0 1], [23 5] [-1 -1], [25 52] [1 1], [44 52] [0 1], [1 33] [0 1], [16 61] [1 1], [40 41] [1 0], [41 27] [1 -1], [33 24] [-1 -1], [16 34] [1 1], [37 38] [1 0], [55 47] [0 -1], [13 15] [1 0], [15 11] [-1 0], [48 8] [0 -1], [48 40] [0 -1], [58 57] [-1 0], [63 57] [-1 0], [43 27] [0 -1], [21 22] [1 0], [38 46] [0 1], [10 34] [0 1], [18 26] [0 1], [11 9] [-1 0], [10 37] [1 1], [9 25] [0 1], [27 63] [1 1], [36 12] [0 -1], [32 37] [1 0], [25 31] [1 0], [58 37] [1 -1], [52 45] [1 -1], [6 41] [-1 1], [11 2] [-1 -1], [4 3] [-1 0], [24 42] [1 1], [14 30] [0 1], [47 45] [-1 0], [47 2] [-1 -1], [52 4] [0 -1], [18 32] [-1 1], [34 27] [1 -1], [30 51] [-1 1], [53 60] [-1 1], [51 44] [1 -1], [16 32] [0 1], [48 51] [1 0], [44 43] [-1 0], [46 14] [0 -1], [41 9] [0 -1], [57 22] [1 -1], [61 37] [0 -1], [19 16] [-1 0], [15 22] [-1 1], [37 44] [-1 1], [20 27] [-1 1], [25 33] [0 1], [38 39] [1 0], [63 62] [-1 0], [9 18] [1 1], [21 7] [1 -1], [41 13] [1 -1], [44 46] [1 0], [36 33] [-1 0], [25 1] [0 -1], [27 41] [-1 1], [49 58] [1 1], [32 39] [1 0], [28 27] [-1 0], [27 20] [1 -1], [5 53] [0 1], [34 13] [1 -1], [41 45] [1 0], [40 5] [1 -1], [24 56] [0 1], [13 8] [-1 0], [42 35] [1 -1], [4 12] [0 1], [52 28] [0 -1], [27 29] [1 0], [23 19] [-1 0], [56 48] [0 -1], [20 28] [0 1], [61 5] [0 -1], [7 21] [-1 1], [54 62] [0 1], [3 19] [0 1], [37 34] [-1 0], [29 22] [1 -1], [46 55] [1 1], [27 3] [0 -1], [56 14] [1 -1], [10 15] [1 0], [13 6] [1 -1], [39 12] [-1 -1], [33 38] [1 0], [40 46] [1 0], [46 62] [0 1], [0 56] [0 1], [23 58] [-1 1], [4 52] [0 1], [38 31] [1 -1], [38 47] [1 1], [41 50] [1 1], [1 0] [-1 0], [44 37] [1 -1], [3 59] [0 1], [47 7] [0 -1], [43 34] [-1 -1], [30 14] [0 -1], [2 3] [1 0], [58 23] [1 -1], [40 33] [1 -1], [2 5] [1 0], [7 2] [-1 0], [46 30] [0 -1], [57 15] [1 -1], [44 58] [-1 1], [26 19] [1 -1], [58 62] [1 0], [22 17] [-1 0], [15 55] [0 1], [10 13] [1 0], [39 60] [-1 1], [29 15] [1 -1], [34 52] [1 1], [47 31] [0 -1], [56 8] [0 -1], [45 29] [0 -1], [51 37] [1 -1], [26 33] [-1 1], [63 56] [-1 0], [18 0] [-1 -1], [52 60] [0 1], [31 23] [0 -1], [30 27] [-1 0], [8 53] [1 1], [37 51] [-1 1], [39 47] [0 1], [61 63] [1 0], [6 7] [1 0], [38 36] [-1 0], [19 59] [0 1], [36 35] [-1 0], [12 13] [1 0], [56 0] [0 -1], [33 5] [1 -1], [15 12] [-1 0], [37 13] [0 -1], [36 44] [0 1], [20 18] [-1 0], [48 55] [1 0], [4 32] [-1 1], [32 8] [0 -1], [37 29] [0 -1], [3 35] [0 1], [9 54] [1 1], [37 39] [1 0], [12 14] [1 0], [15 47] [0 1], [26 10] [0 -1], [7 4] [-1 0], [56 62] [1 0], [33 42] [1 1], [55 54] [-1 0], [21 12] [-1 -1], [55 39] [0 -1], [12 36] [0 1], [35 8] [-1 -1], [9 15] [1 0], [54 27] [-1 -1], [12 40] [-1 1], [37 61] [0 1], [57 25] [0 -1], [34 48] [-1 1], [0 6] [1 0], [32 34] [1 0], [39 46] [-1 1], [46 6] [0 -1], [43 52] [1 1], [40 45] [1 0], [31 4] [-1 -1], [60 33] [-1 -1], [26 31] [1 0], [36 60] [0 1], [28 56] [-1 1], [43 11] [0 -1], [13 12] [-1 0], [28 10] [-1 -1], [10 9] [-1 0], [37 5] [0 -1], [5 4] [-1 0], [46 41] [-1 0], [22 20] [-1 0], [10 8] [-1 0], [31 26] [-1 0], [25 30] [1 0], [18 2] [0 -1], [45 46] [1 0], [6 3] [-1 0], [48 24] [0 -1], [57 60] [1 0], [52 55] [1 0], [31 59] [-1 1], [46 37] [-1 -1], [24 25] [1 0], [18 58] [0 1], [20 12] [0 -1], [36 43] [-1 1], [57 49] [0 -1], [38 2] [-1 -1], [21 3] [-1 -1], [58 40] [-1 -1], [17 16] [-1 0], [31 45] [-1 1], [53 8] [-1 -1], [5 37] [0 1], [0 5] [1 0], [60 4] [0 -1], [14 6] [0 -1], [3 4] [1 0], [56 21] [1 -1], [57 36] [1 -1], [14 28] [-1 1], [25 27] [1 0], [57 33] [0 -1], [13 22] [1 1], [40 24] [0 -1], [32 38] [1 0], [23 55] [0 1], [44 12] [0 -1], [17 18] [1 0], [51 50] [-1 0], [4 25] [-1 1], [32 18] [1 -1], [35 38] [1 0], [50 53] [1 0], [33 26] [1 -1], [52 44] [0 -1], [59 56] [-1 0], [11 14] [1 0], [43 50] [-1 1], [28 14] [1 -1], [44 35] [-1 -1], [60 20] [0 -1], [27 25] [-1 0], [19 22] [1 0], [12 8] [-1 0], [35 26] [-1 -1], [12 5] [1 -1], [63 39] [0 -1], [17 23] [1 0], [12 44] [0 1], [28 1] [-1 -1], [36 39] [1 0], [41 17] [0 -1], [63 45] [-1 -1], [0 40] [0 1], [7 3] [-1 0], [22 18] [-1 0], [43 36] [1 -1], [35 32] [-1 0], [23 51] [-1 1], [34 61] [1 1], [16 43] [1 1], [15 23] [0 1], [50 58] [0 1], [19 12] [1 -1], [17 57] [0 1], [56 49] [1 -1], [22 15] [1 -1], [24 0] [0 -1], [43 22] [1 -1], [51 55] [1 0], [44 51] [-1 1], [40 56] [0 1], [55 50] [-1 0], [36 27] [-1 -1], [38 52] [-1 1], [22 38] [0 1], [44 36] [0 -1], [47 61] [-1 1], [44 62] [1 1], [46 54] [0 1], [25 61] [1 1], [22 31] [1 1], [31 25] [-1 0], [39 3] [-1 -1], [36 57] [-1 1], [26 8] [-1 -1], [31 29] [-1 0], [12 39] [1 1], [45 5] [0 -1], [15 9] [-1 0], [0 48] [0 1], [14 21] [-1 1], [17 1] [0 -1], [48 32] [0 -1], [31 30] [-1 0], [18 34] [0 1], [61 52] [-1 -1], [18 27] [1 1], [5 33] [-1 1], [62 14] [0 -1], [51 59] [0 1], [59 38] [1 -1], [50 49] [-1 0], [4 2] [-1 0], [42 41] [-1 0], [53 54] [1 0], [34 58] [0 1], [39 31] [0 -1], [14 13] [-1 0], [0 18] [1 1], [37 1] [-1 -1], [18 19] [1 0], [58 60] [1 0], [12 60] [0 1], [16 40] [0 1], [9 16] [-1 1], [29 21] [0 -1], [3 12] [1 1], [47 41] [-1 0], [36 4] [0 -1], [20 16] [-1 0], [14 56] [-1 1], [60 46] [1 -1], [57 43] [1 -1], [37 28] [-1 -1], [33 19] [1 -1], [22 62] [0 1], [7 56] [-1 1], [11 25] [-1 1], [58 51] [1 -1], [35 17] [-1 -1], [51 58] [-1 1], [14 54] [0 1], [51 11] [0 -1], [31 39] [0 1], [34 16] [-1 -1], [28 44] [0 1], [13 41] [-1 1], [42 26] [0 -1], [51 54] [1 0], [18 10] [0 -1], [31 15] [0 -1], [38 29] [-1 -1], [21 20] [-1 0], [40 48] [0 1], [18 42] [0 1], [40 43] [1 0], [61 21] [0 -1], [22 13] [-1 -1], [42 33] [-1 -1], [3 0] [-1 0], [46 38] [0 -1], [10 17] [-1 1], [12 28] [0 1], [48 16] [0 -1], [20 29] [1 1], [58 63] [1 0], [9 0] [-1 -1], [59 19] [0 -1], [63 58] [-1 0], [42 60] [1 1], [43 3] [0 -1], [15 43] [-1 1], [49 53] [1 0], [19 23] [1 0], [43 59] [0 1], [11 13] [1 0], [36 45] [1 1], [54 14] [0 -1], [52 61] [1 1], [51 24] [-1 -1], [43 46] [1 0], [13 9] [-1 0], [63 47] [0 -1], [44 17] [-1 -1], [2 47] [1 1], [1 37] [1 1], [50 10] [0 -1], [44 60] [0 1], [42 58] [0 1], [19 10] [-1 -1], [43 25] [-1 -1], [29 61] [0 1], [6 13] [-1 1], [16 2] [1 -1], [56 28] [1 -1], [26 2] [0 -1], [1 9] [0 1], [54 0] [-1 -1], [62 55] [1 -1], [18 11] [1 -1], [15 31] [0 1], [8 62] [1 1], [3 30] [1 1], [48 13] [1 -1], [44 41] [-1 0], [49 17] [0 -1], [13 45] [0 1], [25 57] [0 1], [22 46] [0 1], [36 29] [1 -1], [36 54] [1 1], [11 18] [-1 1], [40 0] [0 -1], [62 61] [-1 0], [11 20] [1 1], [59 61] [1 0], [15 57] [-1 1], [34 43] [1 1], [60 39] [1 -1], [8 10] [1 0], [52 54] [1 0], [5 3] [-1 0], [18 4] [1 -1], [61 53] [0 -1], [35 51] [0 1], [54 50] [-1 0], [49 25] [0 -1], [37 23] [1 -1], [38 62] [0 1], [34 32] [-1 0], [30 37] [-1 1], [46 42] [-1 0], [35 3] [0 -1], [10 19] [1 1], [62 30] [0 -1], [30 6] [0 -1], [28 4] [0 -1], [11 47] [1 1], [53 52] [-1 0], [58 56] [-1 0], [53 44] [-1 -1], [40 49] [1 1], [62 57] [-1 0], [2 20] [1 1], [54 48] [-1 0], [39 32] [-1 0], [9 12] [1 0], [46 39] [1 -1], [13 21] [0 1], [62 6] [0 -1], [61 16] [-1 -1], [24 40] [0 1], [7 35] [-1 1], [4 44] [0 1], [28 46] [1 1], [60 52] [0 -1], [53 62] [1 1], [23 15] [0 -1], [40 19] [1 -1], [20 41] [-1 1], [61 45] [0 -1], [19 43] [0 1], [35 21] [1 -1], [24 28] [1 0], [46 45] [-1 0], [60 44] [0 -1], [36 15] [1 -1], [0 24] [0 1], [56 61] [1 0], [37 10] [-1 -1], [4 7] [1 0], [48 57] [1 1], [51 43] [0 -1], [62 54] [0 -1], [24 3] [1 -1], [6 62] [0 1], [37 53] [0 1], [41 57] [0 1], [20 22] [1 0], [20 11] [-1 -1], [47 44] [-1 0], [49 52] [1 0], [61 47] [1 -1], [48 50] [1 0], [53 61] [0 1], [23 20] [-1 0], [26 24] [-1 0], [5 29] [0 1], [42 40] [-1 0], [14 46] [0 1], [43 19] [0 -1], [26 50] [0 1], [54 61] [-1 1], [49 42] [1 -1], [14 62] [0 1], [26 18] [0 -1], [62 59] [-1 0], [42 34] [0 -1], [28 52] [0 1], [1 10] [1 1], [62 22] [0 -1], [43 61] [1 1], [40 42] [1 0], [57 58] [1 0], [39 33] [-1 0], [2 9] [-1 1], [30 29] [-1 0], [57 1] [0 -1], [10 50] [0 1], [18 9] [-1 -1], [42 10] [0 -1], [51 53] [1 0], [6 5] [-1 0], [59 62] [1 0], [29 43] [-1 1], [49 56] [-1 1], [31 24] [-1 0], [42 14] [1 -1], [38 6] [0 -1], [63 23] [0 -1], [18 50] [0 1], [5 13] [0 1], [37 35] [-1 0], [59 52] [1 -1], [12 33] [-1 1], [49 1] [0 -1], [3 17] [-1 1], [17 53] [1 1], [57 48] [-1 -1], [60 57] [-1 0], [7 47] [0 1], [5 14] [1 1], [31 7] [0 -1], [55 48] [-1 0], [44 40] [-1 0], [8 56] [0 1], [54 6] [0 -1], [3 43] [0 1], [5 40] [-1 1], [19 1] [-1 -1], [36 28] [0 -1], [28 31] [1 0], [59 43] [0 -1], [47 42] [-1 0], [40 26] [1 -1], [4 11] [-1 1], [12 30] [1 1], [60 56] [-1 0], [25 43] [1 1], [47 63] [0 1], [28 60] [0 1], [40 8] [0 -1], [45 59] [-1 1], [55 63] [0 1], [40 44] [1 0], [56 16] [0 -1], [63 18] [-1 -1], [44 47] [1 0], [42 49] [-1 1], [23 16] [-1 0], [50 15] [1 -1], [45 37] [0 -1], [24 31] [1 0], [0 9] [1 1], [8 0] [0 -1], [44 30] [1 -1], [47 46] [-1 0], [45 36] [-1 -1], [38 14] [0 -1], [32 36] [1 0], [62 38] [0 -1], [16 23] [1 0], [45 42] [-1 0], [4 1] [-1 0], [53 46] [1 -1], [56 63] [1 0], [5 2] [-1 0], [30 44] [-1 1], [63 31] [0 -1], [51 52] [1 0], [44 45] [1 0], [8 40] [0 1], [3 21] [1 1], [61 43] [-1 -1], [37 58] [-1 1], [29 47] [1 1], [12 26] [-1 1], [27 34] [-1 1], [47 55] [0 1], [20 13] [1 -1], [19 26] [-1 1], [16 22] [1 0], [32 4] [1 -1], [4 6] [1 0], [27 18] [-1 -1], [14 15] [1 0], [15 7] [0 -1], [34 41] [-1 1], [54 52] [-1 0], [16 8] [0 -1], [59 35] [0 -1], [60 36] [0 -1], [23 14] [-1 -1], [30 25] [-1 0], [33 9] [0 -1], [27 6] [1 -1], [11 4] [1 -1], [1 4] [1 0], [6 22] [0 1], [27 0] [-1 -1], [9 27] [1 1], [10 2] [0 -1], [21 19] [-1 0], [22 21] [-1 0], [11 8] [-1 0], [50 26] [0 -1], [45 53] [0 1], [50 34] [0 -1], [60 42] [-1 -1], [5 7] [1 0], [22 16] [-1 0], [44 28] [0 -1], [59 27] [0 -1], [11 12] [1 0], [50 43] [1 -1], [47 11] [-1 -1], [55 62] [-1 1], [48 54] [1 0], [51 23] [1 -1], [39 21] [-1 -1], [27 54] [1 1], [33 37] [1 0], [33 1] [0 -1], [33 25] [0 -1], [58 44] [1 -1], [1 28] [1 1], [21 14] [1 -1], [48 6] [1 -1], [59 58] [-1 0], [27 13] [1 -1], [55 37] [-1 -1], [63 54] [-1 -1], [42 45] [1 0], [29 2] [-1 -1], [2 34] [0 1], [30 26] [-1 0], [1 57] [0 1], [4 18] [-1 1], [5 26] [-1 1], [16 0] [0 -1], [44 23] [1 -1], [22 30] [0 1], [60 63] [1 0], [54 63] [1 1], [34 39] [1 0], [18 22] [1 0], [58 10] [0 -1], [53 39] [1 -1], [36 52] [0 1], [16 25] [1 1], [29 36] [-1 1], [16 48] [0 1], [29 37] [0 1], [10 58] [0 1], [47 43] [-1 0], [35 59] [0 1], [12 20] [0 1], [23 44] [-1 1], [54 22] [0 -1], [2 26] [0 1], [11 10] [-1 0], [49 54] [1 0], [59 11] [0 -1], [1 55] [1 1], [54 51] [-1 0], [61 59] [-1 0], [50 18] [0 -1], [1 3] [1 0], [23 17] [-1 0], [58 49] [-1 -1], [21 35] [-1 1], [4 36] [0 1], [60 24] [-1 -1], [9 57] [0 1], [30 22] [0 -1], [3 51] [0 1], [28 37] [1 1], [55 15] [0 -1], [63 55] [0 -1], [28 20] [0 -1], [55 19] [-1 -1], [48 0] [0 -1], [10 11] [1 0], [41 32] [-1 -1], [55 49] [-1 0], [19 51] [0 1], [43 42] [-1 0], [50 2] [0 -1], [12 11] [-1 0], [43 15] [1 -1], [13 48] [-1 1], [24 60] [1 1], [25 17] [0 -1], [1 5] [1 0], [51 49] [-1 0], [9 14] [1 0], [12 10] [-1 0], [21 49] [-1 1], [62 60] [-1 0], [38 54] [0 1], [38 22] [0 -1], [11 3] [0 -1], [29 24] [-1 0], [15 10] [-1 0], [1 8] [-1 1], [8 16] [0 1], [21 17] [-1 0], [45 41] [-1 0], [1 7] [1 0], [27 30] [1 0], [61 58] [-1 0], [8 24] [0 1], [12 4] [0 -1], [34 50] [0 1], [63 61] [-1 0], [27 35] [0 1], [13 31] [1 1], [14 35] [-1 1], [16 17] [1 0], [9 33] [0 1], [11 19] [0 1], [6 4] [-1 0], [25 29] [1 0], [18 17] [-1 0], [25 11] [1 -1], [37 19] [-1 -1], [8 1] [1 -1], [50 54] [1 0], [32 0] [0 -1], [0 32] [0 1], [20 17] [-1 0], [10 26] [0 1], [7 42] [-1 1], [52 50] [-1 0], [17 44] [1 1], [61 57] [-1 0], [21 13] [0 -1], [17 41] [0 1], [45 63] [1 1], [50 29] [1 -1], [13 27] [-1 1], [55 46] [-1 -1], [14 8] [-1 0], [47 15] [0 -1], [18 16] [-1 0], [0 3] [1 0], [50 51] [1 0], [55 1] [-1 -1], [27 51] [0 1], [35 56] [-1 1], [14 38] [0 1], [5 1] [-1 0], [6 1] [-1 0], [62 35] [-1 -1], [45 47] [1 0], [41 34] [1 -1], [2 11] [1 1], [6 14] [0 1], [46 28] [-1 -1], [28 42] [-1 1], [23 21] [-1 0], [16 52] [1 1], [61 25] [-1 -1], [5 6] [1 0], [62 56] [-1 0], [27 28] [1 0], [17 26] [1 1], [16 18] [1 0], [63 60] [-1 0], [57 50] [1 -1], [13 11] [-1 0], [53 29] [0 -1], [1 49] [0 1], [41 33] [0 -1], [8 15] [1 0], [23 47] [0 1], [30 12] [-1 -1], [43 51] [0 1], [25 4] [1 -1], [8 13] [1 0], [34 10] [0 -1], [47 40] [-1 0], [21 28] [-1 1], [60 58] [-1 0], [28 7] [1 -1], [0 7] [1 0], [21 30] [1 1], [38 45] [-1 1], [29 53] [0 1], [45 38] [1 -1], [9 17] [0 1], [34 20] [1 -1], [51 27] [0 -1], [14 11] [-1 0], [15 8] [-1 0], [32 33] [1 0], [18 36] [1 1], [23 31] [0 1], [13 5] [0 -1], [45 0] [-1 -1], [9 11] [1 0], [10 1] [-1 -1], [10 12] [1 0], [11 29] [1 1], [21 37] [0 1], [11 27] [0 1], [52 53] [1 0], [52 59] [-1 1], [58 50] [0 -1], [2 7] [1 0], [26 28] [1 0], [26 58] [0 1], [6 46] [0 1], [20 48] [-1 1], [10 46] [1 1], [13 29] [0 1], [19 28] [1 1], [26 40] [-1 1], [58 59] [1 0], [33 36] [1 0], [55 31] [0 -1], [11 59] [0 1], [25 49] [0 1], [41 20] [1 -1], [3 27] [0 1], [45 61] [0 1], [15 29] [-1 1], [46 43] [-1 0], [39 55] [0 1], [4 60] [0 1], [46 19] [-1 -1], [46 60] [-1 1], [51 19] [0 -1], [52 12] [0 -1], [20 52] [0 1], [46 22] [0 -1], [49 28] [1 -1], [13 20] [-1 1], [26 62] [1 1], [47 20] [-1 -1], [19 40] [-1 1], [51 3] [0 -1], [53 50] [-1 0], [40 58] [1 1], [62 26] [-1 -1], [37 46] [1 1], [20 47] [1 1], [15 6] [-1 -1], [11 38] [1 1], [2 4] [1 0], [16 24] [0 1], [59 45] [1 -1], [34 18] [0 -1], [43 47] [1 0], [49 55] [1 0], [3 6] [1 0], [53 45] [0 -1], [45 52] [-1 1], [39 53] [-1 1], [22 36] [-1 1], [61 56] [-1 0], [40 47] [1 0], [7 39] [0 1], [14 23] [1 1], [60 28] [0 -1], [41 49] [0 1], [42 47] [1 0], [6 15] [1 1], [2 58] [0 1], [52 38] [1 -1], [19 35] [0 1], [58 42] [0 -1], [12 15] [1 0], [38 11] [-1 -1], [14 5] [-1 -1], [21 23] [1 0], [17 62] [1 1], [6 27] [-1 1], [51 60] [1 1], [33 39] [1 0], [39 15] [0 -1], [34 25] [-1 -1], [17 3] [1 -1], [52 34] [-1 -1], [28 36] [0 1], [34 35] [1 0], [43 35] [0 -1], [48 56] [0 1], [6 48] [-1 1], [6 30] [0 1], [48 52] [1 0], [60 12] [0 -1], [33 51] [1 1], [19 27] [0 1], [42 18] [0 -1], [35 43] [0 1], [18 25] [-1 1], [22 29] [-1 1], [63 27] [-1 -1], [24 33] [1 1], [28 25] [-1 0], [31 22] [-1 -1], [25 26] [1 0], [40 32] [0 -1], [17 10] [1 -1], [9 2] [1 -1], [7 31] [0 1], [28 55] [1 1], [28 26] [-1 0], [46 10] [-1 -1], [24 48] [0 1], [50 42] [0 -1], [59 57] [-1 0], [5 45] [0 1], [19 5] [1 -1], [33 49] [0 1], [29 57] [-1 1], [57 41] [0 -1], [32 56] [0 1], [4 5] [1 0], [24 30] [1 0], [49 50] [1 0], [42 43] [1 0], [33 60] [1 1], [28 35] [-1 1], [34 6] [1 -1], [53 37] [0 -1], [38 37] [-1 0], [41 25] [0 -1], [45 18] [-1 -1], [25 18] [1 -1], [58 2] [0 -1], [47 29] [-1 -1], [30 21] [-1 -1], [24 29] [1 0], [27 36] [1 1], [39 35] [-1 0], [36 0] [-1 -1], [5 21] [0 1], [61 60] [-1 0], [20 34] [-1 1], [1 41] [0 1], [22 14] [0 -1], [63 15] [0 -1], [39 37] [-1 0], [30 23] [1 -1], [49 57] [0 1], [23 39] [0 1], [9 1] [0 -1], [12 52] [0 1], [41 42] [1 0], [50 55] [1 0], [25 16] [-1 -1], [15 13] [-1 0], [61 54] [1 -1], [59 60] [1 0], [35 62] [1 1], [53 17] [-1 -1], [24 16] [0 -1], [7 0] [-1 0], [41 43] [1 0], [28 24] [-1 0], [10 28] [1 1], [59 50] [-1 -1], [35 33] [-1 0], [57 63] [1 0], [4 22] [1 1], [59 41] [-1 -1], [61 62] [1 0], [35 27] [0 -1], [50 22] [1 -1], [54 55] [1 0], [45 40] [-1 0], [0 16] [0 1], [12 9] [-1 0], [7 55] [0 1], [45 13] [0 -1], [0 2] [1 0], [33 12] [1 -1], [7 28] [-1 1], [48 49] [1 0], [11 51] [0 1], [24 8] [0 -1], [6 54] [0 1], [45 31] [1 -1], [42 2] [0 -1], [19 11] [0 -1], [35 44] [1 1], [12 21] [1 1], [53 51] [-1 0], [24 10] [1 -1], [8 32] [0 1], [54 47] [1 -1], [19 3] [0 -1], [4 20] [0 1], [50 52] [1 0], [11 15] [1 0], [30 28] [-1 0], [11 43] [0 1], [19 21] [1 0], [63 36] [-1 -1], [61 13] [0 -1], [49 9] [0 -1], [51 48] [-1 0], [20 19] [-1 0], [21 5] [0 -1], [40 16] [0 -1], [23 7] [0 -1], [4 31] [1 1], [32 41] [1 1], [49 41] [0 -1], [26 42] [0 1], [8 44] [1 1], [52 20] [0 -1], [32 24] [0 -1], [46 44] [-1 0], [29 25] [-1 0], [2 0] [-1 0], [0 4] [1 0], [43 44] [1 0], [52 36] [0 -1], [44 4] [0 -1], [55 7] [0 -1], [29 20] [-1 -1], [3 11] [0 1], [10 18] [0 1], [28 49] [-1 1], [54 30] [0 -1], [55 51] [-1 0], [16 56] [0 1], [51 35] [0 -1], [14 42] [-1 1], [35 42] [-1 1], [42 50] [0 1], [56 7] [1 -1], [24 17] [1 -1], [37 33] [-1 0], [13 61] [0 1], [19 18] [-1 0], [54 49] [-1 0], [9 13] [1 0], [36 50] [-1 1], [9 63] [1 1], [3 1] [-1 0], [30 31] [1 0], [58 34] [0 -1], [59 32] [-1 -1], [7 63] [0 1], [8 35] [1 1], [38 20] [-1 -1], [49 7] [1 -1], [3 10] [-1 1], [56 40] [0 -1], [31 63] [0 1], [12 3] [-1 -1], [41 1] [0 -1], [28 21] [1 -1], [21 53] [0 1], [30 3] [-1 -1], [26 29] [1 0], [42 44] [1 0], [34 42] [0 1], [46 47] [1 0], [31 55] [0 1], [57 61] [1 0], [23 22] [-1 0], [63 59] [-1 0], [27 11] [0 -1], [29 31] [1 0], [55 52] [-1 0], [1 17] [0 1], [13 53] [0 1], [2 1] [-1 0], [43 16] [-1 -1], [51 33] [-1 -1], [25 28] [1 0], [35 53] [1 1], [10 55] [1 1], [50 57] [-1 1], [54 36] [-1 -1], [43 57] [-1 1], [26 27] [1 0], [10 42] [0 1], [24 32] [0 1], [17 24] [-1 1], [20 21] [1 0], [31 47] [0 1], [28 30] [1 0], [57 56] [-1 0], [9 41] [0 1], [39 36] [-1 0], [15 36] [-1 1], [3 24] [-1 1], [33 32] [-1 0], [40 12] [1 -1], [39 30] [-1 -1], [12 19] [-1 1], [35 39] [1 0], [27 24] [-1 0], [7 14] [-1 1], [4 28] [0 1], [7 49] [-1 1], [36 22] [1 -1], [20 38] [1 1], [37 55] [1 1], [59 51] [0 -1], [53 5] [0 -1], [42 7] [1 -1], [24 51] [1 1], [41 47] [1 0], [13 34] [-1 1], [56 57] [1 0], [47 38] [-1 -1], [36 32] [-1 0], [62 58] [-1 0], [34 36] [1 0], [4 13] [1 1], [1 6] [1 0], [34 38] [1 0], [21 39] [1 1], [26 35] [1 1], [36 63] [1 1], [34 2] [0 -1], [63 7] [0 -1], [60 51] [-1 -1], [29 5] [0 -1], [16 9] [1 -1], [29 50] [-1 1], [17 19] [1 0], [35 49] [-1 1], [33 17] [0 -1], [0 54] [1 1], [33 35] [1 0], [47 23] [0 -1], [18 63] [1 1], [47 39] [0 -1], [56 42] [1 -1], [58 30] [1 -1], [28 12] [0 -1], [46 53] [-1 1], [47 54] [-1 1], [38 34] [-1 0], [52 51] [-1 0], [22 57] [-1 1], [29 38] [1 1], [24 26] [1 0], [3 7] [1 0], [20 23] [1 0], [0 45] [1 1], [63 9] [-1 -1], [16 20] [1 0], [10 24] [-1 1], [2 10] [0 1], [32 50] [1 1], [7 5] [-1 0], [25 9] [0 -1], [18 21] [1 0], [7 15] [0 1], [0 63] [1 1], [29 11] [-1 -1], [21 29] [0 1], [37 21] [0 -1], [27 48] [-1 1], [13 10] [-1 0], [52 43] [-1 -1], [38 33] [-1 0], [2 6] [1 0], [26 25] [-1 0], [33 40] [-1 1], [33 41] [0 1], [5 0] [-1 0], [11 35] [0 1], [0 36] [1 1], [49 51] [1 0], [50 41] [-1 -1], [44 53] [1 1], [30 62] [0 1], [6 34] [-1 1], [53 55] [1 0], [61 34] [-1 -1], [33 34] [1 0], [6 2] [-1 0], [14 12] [-1 0], [17 9] [0 -1], [55 28] [-1 -1], [44 42] [-1 0], [32 25] [1 -1], [9 10] [1 0], [8 14] [1 0], [30 46] [0 1], [8 12] [1 0], [13 4] [-1 -1], [50 32] [-1 -1], [32 11] [1 -1], [15 50] [-1 1], [30 38] [0 1], [31 27] [-1 0], [57 62] [1 0], [16 21] [1 0], [6 0] [-1 0], [59 31] [1 -1], [45 9] [-1 -1], [23 30] [-1 1], [45 43] [-1 0], [54 46] [0 -1], [39 7] [0 -1], [49 14] [1 -1], [5 23] [1 1], [22 6] [0 -1], [57 59] [1 0], [23 37] [-1 1], [35 34] [-1 0], [22 19] [-1 0], [32 35] [1 0], [2 42] [0 1], [14 7] [1 -1], [46 40] [-1 0], [0 27] [1 1], [36 38] [1 0], [63 0] [-1 -1], [11 32] [-1 1], [5 61] [0 1], [52 49] [-1 0], [18 45] [1 1], [36 34] [-1 0], [6 20] [-1 1], [53 21] [0 -1], [52 48] [-1 0], [23 18] [-1 0], [27 26] [-1 0], [41 6] [1 -1], [34 37] [1 0], [1 2] [1 0], [2 38] [1 1], [54 18] [-1 -1], [20 2] [-1 -1], [14 10] [-1 0], [56 24] [0 -1], [41 46] [1 0], [44 26] [-1 -1], [58 26] [0 -1], [62 63] [1 0], [14 49] [-1 1], [15 14] [-1 0], [46 1] [-1 -1], [26 17] [-1 -1], [32 16] [0 -1], [2 16] [-1 1], [24 27] [1 0], [17 35] [1 1], [19 17] [-1 0], [10 3] [1 -1], [54 38] [0 -1], [18 20] [1 0], [9 45] [1 1], [53 35] [-1 -1], [53 48] [-1 0], [49 33] [0 -1], [49 48] [-1 0], [22 4] [-1 -1], [21 16] [-1 0], [30 58] [-1 1], [3 5] [1 0], [27 31] [1 0], [54 53] [-1 0], [44 8] [-1 -1], [39 23] [0 -1], [13 14] [1 0], [0 8] [0 1], [31 28] [-1 0], [45 21] [0 -1], [25 41] [0 1], [5 12] [-1 1], [30 24] [-1 0], [42 51] [1 1], [32 40] [0 1], [39 63] [0 1], [21 56] [-1 1], [43 45] [1 0], [22 23] [1 0], [35 36] [1 0], [17 22] [1 0], [31 13] [-1 -1], [3 2] [-1 0], [19 46] [1 1], [17 8] [-1 -1], [36 37] [1 0], [42 28] [1 -1], [48 41] [1 -1], [20 60] [0 1], [19 55] [1 1], [20 44] [0 1], [62 46] [0 -1], [56 32] [0 -1], [59 63] [1 0], [30 39] [1 1], [19 37] [1 1], [29 28] [-1 0], [20 4] [0 -1], [55 10] [-1 -1], [26 12] [1 -1], [53 26] [-1 -1], [27 43] [0 1], [35 19] [0 -1], [52 25] [-1 -1], [62 17] [-1 -1], [54 9] [-1 -1], [14 9] [-1 0], [53 13] [0 -1], [57 17] [0 -1], [57 29] [1 -1], [29 30] [1 0], [15 63] [0 1], [48 34] [1 -1], [22 43] [-1 1], [26 53] [1 1], [56 35] [1 -1], [39 38] [-1 0], [18 54] [1 1], [19 20] [1 0], [45 54] [1 1], [21 45] [0 1], [57 9] [0 -1], [43 41] [-1 0], [55 23] [0 -1], [50 36] [1 -1], [41 59] [1 1], [29 13] [0 -1], [2 50] [0 1], [33 57] [0 1], [48 20] [1 -1], [41 40] [-1 0], [20 36] [0 1], [41 48] [-1 1], [49 40] [-1 -1], [2 29] [1 1], [49 21] [1 -1], [26 5] [1 -1], [26 30] [1 0], [0 1] [1 0], [29 45] [0 1], [22 54] [0 1], [41 44] [1 0], [45 44] [-1 0], [32 48] [0 1], [39 34] [-1 0], [37 32] [-1 0], [56 58] [1 0], [58 61] [1 0], [1 19] [1 1], [60 62] [1 0], [60 53] [1 -1], [20 6] [1 -1], [29 26] [-1 0], [52 31] [1 -1], [45 27] [-1 -1], [22 50] [-1 1], [51 30] [1 -1], [48 27] [1 -1], [8 17] [1 1], [61 29] [0 -1], [25 32] [-1 1], [29 27] [-1 0], [17 21] [1 0], [9 36] [1 1], [17 20] [1 0], [4 0] [-1 0], [56 60] [1 0], [60 61] [1 0], [17 33] [0 1], [58 18] [0 -1]}))

(defn some [f coll] (reduce (fn [_ x] (when-let [y (f x)] (reduced y))) nil coll))

(defn path-blocked? [board from to] (boolean (some board (tiles-between [from to]))))

(defn attack? [board side dir target] (loop [tiles (map file+rank->index (filter (fn [[x y]] (within-board? x y)) (ray (index->file+rank target) dir)))] (when-not (empty? tiles) (let [[tile & tiles] tiles] (if-let [piece (nth board tile)] (if (= (piece->color piece) side) false (contains? (get-in capture-moves [piece tile]) target)) (recur tiles))))))

(defn pinned? [state from to] (let [board (:board state) side (:side state) king-position (get-in state [:king-positions side])] (if (= king-position from) false (when-let [dir (direction-between [king-position from])] (let [board0 (assoc board from nil to (nth board from))] (attack? board0 side dir king-position))))))

(defn check?0 [state] (let [board (:board state) side (:side state) king-position (get-in state [:king-positions side])] (when king-position (or (let [opponent-knight (switch side :b :wN :bN)] (some (fn [pos] (= (nth board pos) opponent-knight)) (get-in possible-moves [opponent-knight king-position]))) (some (fn [dir] (attack? board side dir king-position)) king-deltas)))))

(defn check? [state from to] (let [board (:board state) side (:side state) king-positions (:king-positions state) king-position (get king-positions side)] (check?0 (assoc state :board (assoc board from nil to (nth board from)) :king-positions (assoc king-positions side (if (= king-position from) to king-position))))))

(defn execute-castling [state king-from king-to castle-from castle-to] (let [side (:side state) castling (:castling state) board (:board state) king-positions (:king-positions state)] (assoc state :castling (switch side :w (disj castling white-queenside-castling white-kingside-castling) :b (disj castling black-queenside-castling black-kingside-castling)) :board (assoc board king-from nil king-to (nth board king-from) castle-from nil castle-to (nth board castle-from)) :king-positions (assoc king-positions side king-to))))

(defn explain-castling [state from to] (let [castling (:castling state)] (when (contains? castling [from to]) (let [board (:board state)] (when-let [f (get {white-kingside-castling (fn [] (cond (path-blocked? board from 7) [false :castling-blocked] (check?0 state) [false :castling-in-check] (check? state from 5) [false :castling-through-check] :else (let [state0 (execute-castling state from to 7 5)] (if (check?0 state0) [false :castling-through-check] [true :castling-white-kingside state0])))), white-queenside-castling (fn [] (cond (path-blocked? board from 0) [false :castling-blocked] (check?0 state) [false :castling-in-check] (check? state from 3) [false :castling-through-check] :else (let [state0 (execute-castling state from to 0 3)] (if (check?0 state0) [false :castling-through-check] [true :castling-white-queenside state0])))), black-kingside-castling (fn [] (cond (path-blocked? board from 63) [false :castling-blocked] (check?0 state) [false :castling-in-check] (check? state from 61) [false :castling-through-check] :else (let [state0 (execute-castling state from to 63 61)] (if (check?0 state0) [false :castling-through-check] [true :castling-black-kingside state0])))), black-queenside-castling (fn [] (cond (path-blocked? board from 56) [false :castling-blocked] (check?0 state) [false :castling-in-check] (check? state from 59) [false :castling-through-check] :else (let [state0 (execute-castling state from to 56 59)] (if (check?0 state0) [false :castling-through-check] [true :castling-black-queenside state0]))))} [from to])] (f))))))

(defn update-castling [state piece] (switch piece 0 (update state :castling disj white-queenside-castling) 7 (update state :castling disj white-kingside-castling) 56 (update state :castling disj black-queenside-castling) 63 (update state :castling disj black-kingside-castling) state))

(defn move-piece [state from to] (let [board (:board state) side (:side state) from-piece (nth board from) state0 (update-castling (assoc state :board (assoc board from nil to from-piece)) to)] (switch from-piece :wK (let [state1 (assoc-in state0 [:king-positions side] to)] (update state1 :castling (fn [castling] (disj castling white-queenside-castling white-kingside-castling)))) :bK (let [state1 (assoc-in state0 [:king-positions side] to)] (update state1 :castling (fn [castling] (disj castling black-queenside-castling black-kingside-castling)))) :wR (update-castling state0 from) :bR (update-castling state0 from) state0)))

(defn explain-en-passant [state from to] (let [board (:board state) from-piece (nth board from) ep (:ep state)] (when (and (contains? ep [from to]) (contains? #{:bP :wP} from-piece)) (let [captured-piece (file+rank->index [(index->file to) (index->rank from)])] (if (pinned? state from to) [false :pinned state] [true :en-passant (assoc state :ep nil :board (assoc board from nil to from-piece captured-piece nil))])))))

(def white-double-push-ep (into {} (map (fn [file] (let [from (file+rank->index [file 1]) to (file+rank->index [file 3]) ep (file+rank->index [file 2])] [[from to] ep])) (range 0 8))))

(def black-double-push-ep (into {} (map (fn [file] (let [from (file+rank->index [file 6]) to (file+rank->index [file 4]) ep (file+rank->index [file 5])] [[from to] ep])) (range 0 8))))

(def double-push-ep (merge white-double-push-ep black-double-push-ep))

(defn double-push->ep-coords [push-from push-to] (let [ep-to (int (+ push-from (/ (- push-to push-from) 2))) left [(dec push-to) ep-to] right [(inc push-to) ep-to]] (switch (index->file ep-to) 0 #{right} 7 #{left} #{left right})))

(defn explain-pawn-move* [state from to promotion-piece] (let [board (:board state) side (:side state) from-piece (nth board from)] (when (contains? #{:bP :wP} from-piece) (cond (contains? double-push-ep [from to]) (let [ep-options (into #{} (filter (fn [[ep-from _]] (let [ep-piece (nth board ep-from)] (and (contains? #{:bP :wP} ep-piece) (not= from-piece ep-piece)))) (double-push->ep-coords from to)))] [true :pawn-double-push (assoc state :ep ep-options :board (assoc board from nil to from-piece))]) (or (<= 0 to 7) (<= 56 to 63)) (if (contains? #{:R :Q :B :N} promotion-piece) [true :promotion (update-castling (assoc state :board (assoc board from nil to (keyword (str (name side) (name promotion-piece))))) to)] [false :invalid-promotion state])))))

(defn explain-move* [state from to promotion-piece] (let [board (:board state)] (if-let [from-piece (nth board from)] (let [side (:side state) from-color (piece->color from-piece)] (if (= from-color side) (let [to-piece (nth board to) to-color (piece->color to-piece)] (if (= from-color to-color) [false :self-landing state] (let [options (if to-piece capture-moves possible-moves)] (if (contains? (get-in options [from-piece from]) to) (if (path-blocked? board from to) [false :blocked state] (if (pinned? state from to) [false :pinned state] (if (check? state from to) [false :check state] (or (explain-pawn-move* state from to promotion-piece) [true :normal (move-piece state from to)])))) (or (explain-castling state from to) (explain-en-passant state from to) [false :impossible state]))))) [false :wrong-color state])) [false :no-piece state])))

(defn move* ([state from to] (move* state from to nil)) ([state from to promotion-piece] (let [ep-before (:ep state) [ok? description state] (explain-move* state from to promotion-piece) side (:side state)] (if ok? (update (assoc state :side (switch side :w :b :b :w)) :ep (fn [ep-after] (if (= ep-before ep-after) nil ep-after))) (fail :ASSERT (str "Invalid move " description))))))

(defn move [state uci] (apply move* state (uci->from+to uci)))

(def start-fen "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1")

(defn moves ([ucis] (moves (fen->state start-fen) ucis)) ([state ucis] (reduce move state ucis)))

(defn piece->char [piece] (switch piece :bR \r :bB \b :bN \n :bQ \q :bK \k :bP \p :wR \R :wB \B :wN \N :wQ \Q :wK \K :wP \P))

(def fen-positions (mapv (fn [i] (let [[file rank] [(rem i 8) (- 7 (quot i 8))]] (+ file (* rank 8)))) all-positions))

(defn board-vec->board-str [board] (let [[s cnt] (reduce (fn [[s cnt] i] (let [[s cnt] (if (zero? (mod i 8)) [(str s (if (zero? cnt) "" cnt) (if (= i 56) "" "/")) 0] [s cnt])] (if-let [piece (nth board i)] [(str s (if (zero? cnt) "" cnt) (piece->char piece)) 0] [s (inc cnt)]))) ["" 0] fen-positions)] (str s (if (zero? cnt) "" cnt))))

(defn state->fen [state] (let [board (:board state) side (:side state) castling (:castling state) ep (:ep state)] (str (board-vec->board-str board) " " (name side) " " (castling->str castling) " " (or (when-let [idx (get-in (vec ep) [0 1])] (index->coord idx)) "-") " " "0" " " "0")))

(defn valid-move?* ([state from to] (valid-move?* state from to nil)) ([state from to promotion-piece] (first (explain-move* state from to promotion-piece))))

(defn valid-move? [fen uci] (let [state (fen->state fen) [from to promotion-piece] (uci->from+to uci)] (valid-move?* state from to promotion-piece)))

(defn explain-move [fen uci] (let [state (fen->state fen) [from to promotion-piece] (uci->from+to uci)] (second (explain-move* state from to promotion-piece))))

(def start-state (fen->state start-fen))

(defn game [uci-str] (reduce move start-state (do (split uci-str \space))))